@use "../palette/dracula" as drac;
@use "../palette/slate" as sla;
@use "../palette/default" as def;
@use "sass:color";
@use "sass:list";

$themes: (dracula, slate, default);
$new-admonitions: (
  settings config: drac.$pink def.$clr-purple-a700 "@mdi/svg/svg/cog.svg",
  new: drac.$yellow def.$clr-yellow-a700 "@mdi/svg/svg/alert-decagram.svg",
  sh-luv: def.$clr-red-a200 drac.$dark-red var(--md-admonition-icon-sh-luv)
) !default;
$old-admonitions: (
  note: drac.$dark-yellow,
  abstract: drac.$cyan,
  info: drac.$light-blue,
  tip: drac.$teal,
  success: drac.$green,
  question: drac.$light-green,
  warning: drac.$orange,
  failure: drac.$dark-red,
  danger: drac.$red,
  bug: drac.$dark-pink,
  example: drac.$purple,
  quote: drac.$grey
) !default;

/* Style new admonitions with dark or light colors */
:root > * {
  --md-admonition-bg-color: transparent;

  &[data-md-color-scheme="dracula"] {
    --md-admonition-icon-color: #{drac.$dark-yellow};
  }

  @each $names, $prop in $new-admonitions {
    $tint: list.nth($prop, 1);
    $tint2: list.nth($prop, 2);
    $name: list.nth($names, 1);

    /* --md-admonition-icon--#{$name}: svg-load("#{list.nth($prop, 3)}"); */

    --md-admonition-bg-color-#{$name}: #{color.adjust($tint2, $alpha: -0.9)};
    --md-admonition-icon-color-#{$name}: #{$tint2};

    &[data-md-color-scheme="dracula"] {
      --md-admonition-bg-color-#{$name}: var(--md-default-bg-color-ultra-dark);
      --md-admonition-icon-color-#{$name}: #{$tint};
    }
  }

  @each $names, $tint in $old-admonitions {
    $name: list.nth($names, 1);

    --md-admonition-bg-color-#{$name}: var(--md-default-bg-color-ultra-dark);
    --md-admonition-icon-color-#{$name}: #{$tint};
  }
}

/* Dark mode changes */
[data-md-color-scheme="dracula"] .md-typeset .admonition {
  border-color: var(--md-admonition-icon-color-note);

  > .admonition-title {
    background-color: var(--md-admonition-bg-color-note);

    &::before {
      background-color: var(--md-admonition-icon-color-note);
    }

    &::after {
      color: var(--md-admonition-icon-color-note);
    }
  }

  box-shadow: var(--md-shadow-z7);
}

/* Style existing admonitions with dark mode colors */
[data-md-color-scheme="dracula"] {
  @each $names, $prop in $old-admonitions {
    $name: list.nth($names, 1);

    // Define base class
    .md-typeset .admonition.#{$name} {
      border-color: var(--md-admonition-icon-color-#{$name});

      // Define base class
      > .admonition-title {
        background-color: var(--md-admonition-bg-color-#{$name});
        border-color: var(--md-admonition-icon-color-#{$name});

        // Icon
        &::before {
          background-color: var(--md-admonition-icon-color-#{$name});
        }

        &::after {
          color: var(--md-admonition-icon-color-#{$name});
        }
      }
    }

    // Define synonyms for base class
    @if list.length($names) > 1 {
      @for $n from 2 through list.length($names) {
        .#{list.nth($names, $n)} {
          @extend .#{$name};
        }
      }
    }
  }
}

[data-md-color-scheme="default"] {
  @each $names, $prop in $old-admonitions {
    $name: list.nth($names, 1);

    // Define base class
    .md-typeset .admonition.#{$name} {
      border-color: var(--md-admonition-icon-color-#{$name});

      // Define base class
      > .admonition-title {
        background-color: var(--md-admonition-bg-color-#{$name});
        border-color: var(--md-admonition-icon-color-#{$name});

        // Icon
        &::before {
          background-color: var(--md-admonition-icon-color-#{$name});
        }

        &::after {
          color: var(--md-admonition-icon-color-#{$name});
        }
      }
    }
  }
}

@each $names, $prop in $new-admonitions {
  $name: list.nth($names, 1);

  // Define base class
  .md-typeset .admonition.#{$name} {
    border-color: var(--md-admonition-icon-color-#{$name});

    > .admonition-title {
      background-color: var(--md-admonition-bg-color-#{$name});
      border-color: var(--md-admonition-icon-color-#{$name});

      // Icon
      &::before {
        width: px2rem(20px);
        height: px2rem(20px);
        background-color: var(--md-admonition-icon-color-#{$name});
        background-size: px2rem(20px);
        mask-image: var(--md-admonition-icon-#{$name});
        content: "\a0";
      }

      &::after {
        color: var(--md-admonition-icon-color-#{$name});
      }
    }
  }

  // Define synonyms for base class
  @if list.length($names) > 1 {
    @for $n from 2 through list.length($names) {
      .#{list.nth($names, $n)} {
        @extend .#{$name};
      }
    }
  }
}

@media screen and (width >= 45em) {
  .md-typeset .inline {
    width: fit-content;
    max-width: 20.7rem;
    margin-top: 0;
    margin-bottom: 0.8rem;
  }
}

.quote > p.admonition-title {
  align-items: center;
  padding: 10px;
}

.quote > p.admonition-title > a {
  margin-right: 15px;
}

li > a > img {
  border-radius: 0;
}

.md-typeset .admonition-title {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.md-typeset details,
.md-typeset .admonition {
  border-radius: 0.3rem;
  overflow: hidden;
  border-width: 0;
  border-left-width: 4px;
}

.md-typeset .sh-luv > .admonition-title::before,
.md-typeset .sh-luv > summary::before {
  animation: heart 1000ms infinite;
}

@keyframes heart {
  0%,
  40%,
  80%,
  100% {
    transform: scale(1);
  }

  20%,
  60% {
    transform: scale(1.15);
  }
}

.heart {
  color: red;
  animation: heart 1000ms infinite;
}

//.md-typeset .warning>.admonition-title,
//.md-typeset .warning>summary {
//    background-color:var(--md-admonition-bg-color-warning);
//}
