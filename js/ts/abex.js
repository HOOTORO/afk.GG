import { buildElement, buildProperty, createElem, elProp, genId, } from "./components/doManager.js";
import { aeIcons, Boss } from "./model/constants.js";
import { loadBag, RelicEstimator } from "./abex/relicEstimate.js";
import { elTag, Input, log } from "./components/helper.js";
import { Militia } from "./types/militia.js";
import { Expeditor } from "./types/expeditor.js";
import { Locations } from "./util/locations.js";
import { stam } from "./types/abex-resource.js";
import { AttackForm } from "./abex/attackform.js";
export const mil = new Militia(10);
export const expeditor = new Expeditor(mil, false);
switch (window.location.pathname) {
    case Locations.abex:
        RelicEstimator();
        loadBag();
        break;
    case Locations.warBook:
        log(`may be PIDOR? ${window.location.pathname}\nno, you PIDOR may be? ${Locations.warBook}`);
        AttackForm();
        foodRemain();
        break;
    default:
        console.log("nothing to do here");
}
export function foodRemain() {
    const app = document.getElementById("rem-food");
    if (!app) {
        console.log(`no app tag, return`);
    }
    else {
        initForm(app);
        window.onload = updateAbex;
        app.addEventListener("change", (e) => {
            if (e.target instanceof HTMLInputElement) {
                inputChange(e.target);
                updateAbex();
            }
        });
    }
}
function updateAbex() {
    mil.viewers = parseInt(document.getElementById("mil-specs").getAttribute("value"));
    const sod = document.getElementById("mil-sod");
    expeditor.star = sod.checked ? true : false;
    expeditor.stamina.value = parseInt(document.getElementById("ex-food").getAttribute("value"));
    let totalFood = expeditor.SilentStam();
    let atl = totalFood / Boss.foodCost;
    let rtyLeft = (totalFood % Boss.foodCost) / Boss.retry;
    document.getElementById("total-food").innerText =
        Math.floor(totalFood).toString();
    document.getElementById("attacks-left").innerText =
        Math.floor(atl).toString();
    document.getElementById("retry-breakpoint").innerText = rtyLeft.toFixed(1);
}
function initForm(n) {
    const inputFields = [
        {
            n: elTag.Input,
            v: "AbEx Start",
            props: [
                buildProperty("type", Input.Datetime),
                buildProperty("id", "abex-date"),
            ],
        },
        {
            n: elTag.Input,
            v: "Current Stam",
            props: [
                buildProperty("type", "number"),
                buildProperty("id", "ex-food"),
                buildProperty("min", "0"),
                buildProperty("max", "9999"),
                buildProperty("size", "20"),
                buildProperty("value", "0"),
                buildProperty("icon", stam),
            ],
        },
        {
            n: elTag.Input,
            v: "Spectators",
            props: [
                buildProperty("type", "number"),
                buildProperty("id", "mil-specs"),
                buildProperty("min", "0"),
                buildProperty("max", "10"),
                buildProperty("size", "20"),
                buildProperty("value", "0"),
                buildProperty("icon", aeIcons.bpEnter),
            ],
        },
        {
            n: elTag.Input,
            v: "Star of Dawn",
            props: [
                buildProperty("type", "checkbox"),
                buildProperty("id", "mil-sod"),
                buildProperty("icon", aeIcons.bpEnterImg),
            ],
        },
    ];
    const outputFields = ["Total Food", "Attacks left", "Retry Breakpoint"];
    const out = createElem(elTag.Div, buildProperty(elProp.Class, "outbox"));
    const form = createElem(elTag.Form, buildProperty(elProp.Id, "abex-form"));
    for (const field of inputFields) {
        form.appendChild(buildElement(field.n, field.props, field.v));
    }
    for (const o of outputFields) {
        out.appendChild(buildElement(elTag.Span, [buildProperty(elProp.Id, `${genId(o)}`)], o));
    }
    n.appendChild(form);
    n.appendChild(out);
}
function inputChange(e) {
    if (e.type === "checkbox") {
        e.checked ? e.setAttribute("checked", "") : e.removeAttribute("checked");
    }
    else {
        e.setAttribute("value", e.value);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWJleC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9hYmV4LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTCxZQUFZLEVBQ1osYUFBYSxFQUNiLFVBQVUsRUFDVixNQUFNLEVBQ04sS0FBSyxHQUNOLE1BQU0sMkJBQTJCLENBQUM7QUFDbkMsT0FBTyxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUVyRCxPQUFPLEVBQUUsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLHlCQUF5QixDQUFDO0FBQ2xFLE9BQU8sRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBQzNELE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUM3QyxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDakQsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ2hELE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUNoRCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFFbEQsTUFBTSxDQUFDLE1BQU0sR0FBRyxHQUFHLElBQUksT0FBTyxDQUFDLEVBQUUsQ0FBQyxDQUFDO0FBQ25DLE1BQU0sQ0FBQyxNQUFNLFNBQVMsR0FBRyxJQUFJLFNBQVMsQ0FBQyxHQUFHLEVBQUUsS0FBSyxDQUFDLENBQUM7QUFFbkQsUUFBUSxNQUFNLENBQUMsUUFBUSxDQUFDLFFBQVEsRUFBRSxDQUFDO0lBQ2pDLEtBQUssU0FBUyxDQUFDLElBQUk7UUFDakIsY0FBYyxFQUFFLENBQUM7UUFDakIsT0FBTyxFQUFFLENBQUM7UUFDVixNQUFNO0lBQ1IsS0FBSyxTQUFTLENBQUMsT0FBTztRQUNwQixHQUFHLENBQ0QsaUJBQWlCLE1BQU0sQ0FBQyxRQUFRLENBQUMsUUFB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bnRlbnQiOlsiaW1wb3J0IHtcbiAgYnVpbGRFbGVtZW50LFxuICBidWlsZFByb3BlcnR5LFxuICBjcmVhdGVFbGVtLFxuICBlbFByb3AsXG4gIGdlbklkLFxufSBmcm9tIFwiLi9jb21wb25lbnRzL2RvTWFuYWdlci5qc1wiO1xuaW1wb3J0IHsgYWVJY29ucywgQm9zcyB9IGZyb20gXCIuL21vZGVsL2NvbnN0YW50cy5qc1wiO1xuXG5pbXBvcnQgeyBsb2FkQmFnLCBSZWxpY0VzdGltYXRvciB9IGZyb20gXCIuL2FiZXgvcmVsaWNFc3RpbWF0ZS5qc1wiO1xuaW1wb3J0IHsgZWxUYWcsIElucHV0LCBsb2cgfSBmcm9tIFwiLi9jb21wb25lbnRzL2hlbHBlci5qc1wiO1xuaW1wb3J0IHsgTWlsaXRpYSB9IGZyb20gXCIuL3R5cGVzL21pbGl0aWEuanNcIjtcbmltcG9ydCB7IEV4cGVkaXRvciB9IGZyb20gXCIuL3R5cGVzL2V4cGVkaXRvci5qc1wiO1xuaW1wb3J0IHsgTG9jYXRpb25zIH0gZnJvbSBcIi4vdXRpbC9sb2NhdGlvbnMuanNcIjtcbmltcG9ydCB7IHN0YW0gfSBmcm9tIFwiLi90eXBlcy9hYmV4LXJlc291cmNlLmpzXCI7XG5pbXBvcnQgeyBBdHRhY2tGb3JtIH0gZnJvbSBcIi4vYWJleC9hdHRhY2tmb3JtLmpzXCI7XG5cbmV4cG9ydCBjb25zdCBtaWwgPSBuZXcgTWlsaXRpYSgxMCk7XG5leHBvcnQgY29uc3QgZXhwZWRpdG9yID0gbmV3IEV4cGVkaXRvcihtaWwsIGZhbHNlKTtcblxuc3dpdGNoICh3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUpIHtcbiAgY2FzZSBMb2NhdGlvbnMuYWJleDpcbiAgICBSZWxpY0VzdGltYXRvcigpO1xuICAgIGxvYWRCYWcoKTtcbiAgICBicmVhaztcbiAgY2FzZSBMb2NhdGlvbnMud2FyQm9vazpcbiAgICBsb2coXG4gICAgICBgbWF5IGJlIFBJRE9SPyAke3dpbmRvdy5sb2NhdGlvbi5wYXRobmFtZX1cXG5ubywgeW91IFBJRE9SIG1heSBiZT8gJHtMb2NhdGlvbnMud2FyQm9va31gXG4gICAgKTtcbiAgICBBdHRhY2tGb3JtKCk7XG4gICAgZm9vZFJlbWFpbigpO1xuICAgIGJyZWFrO1xuICBkZWZhdWx0OlxuICAgIGNvbnNvbGUubG9nKFwibm90aGluZyB0byBkbyBoZXJlXCIpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZm9vZFJlbWFpbigpIHtcbiAgY29uc3QgYXBwID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyZW0tZm9vZFwiKTtcbiAgaWYgKCFhcHApIHtcbiAgICBjb25zb2xlLmxvZyhgbm8gYXBwIHRhZywgcmV0dXJuYCk7XG4gIH0gZWxzZSB7XG4gICAgaW5pdEZvcm0oYXBwKTtcbiAgICB3aW5kb3cub25sb2FkID0gdXBkYXRlQWJleDtcblxuICAgIGFwcC5hZGRFdmVudExpc3RlbmVyKFwiY2hhbmdlXCIsIChlKSA9PiB7XG4gICAgICBpZiAoZS50YXJnZXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7XG4gICAgICAgIGlucHV0Q2hhbmdlKGUudGFyZ2V0KTtcbiAgICAgICAgdXBkYXRlQWJleCgpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG59XG5mdW5jdGlvbiB1cGRhdGVBYmV4KCkge1xuICAvLyB1cGRhdGV2YWx1ZXJzXG4gIG1pbC52aWV3ZXJzID0gcGFyc2VJbnQoXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJtaWwtc3BlY3NcIikuZ2V0QXR0cmlidXRlKFwidmFsdWVcIilcbiAgKTtcbiAgY29uc3Qgc29kID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJtaWwtc29kXCIpIGFzIEhUTUxJbnB1dEVsZW1lbnQ7XG4gIGV4cGVkaXRvci5zdGFyID0gc29kLmNoZWNrZWQgPyB0cnVlIDogZmFsc2U7XG4gIGV4cGVkaXRvci5zdGFtaW5hLnZhbHVlID0gcGFyc2VJbnQoXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJleC1mb29kXCIpLmdldEF0dHJpYnV0ZShcInZhbHVlXCIpXG4gICk7XG5cbiAgLy8gY2FsY3VsYXRpb25zXG4gIGxldCB0b3RhbEZvb2QgPSBleHBlZGl0b3IuU2lsZW50U3RhbSgpO1xuICBsZXQgYXRsID0gdG90YWxGb29kIC8gQm9zcy5mb29kQ29zdDtcbiAgbGV0IHJ0eUxlZnQgPSAodG90YWxGb29kICUgQm9zcy5mb29kQ29zdCkgLyBCb3NzLnJldHJ5O1xuXG4gIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidG90YWwtZm9vZFwiKS5pbm5lclRleHQgPVxuICAgIE1hdGguZmxvb3IodG90YWxGb29kKS50b1N0cmluZygpO1xuICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImF0dGFja3MtbGVmdFwiKS5pbm5lclRleHQgPVxuICAgIE1hdGguZmxvb3IoYXRsKS50b1N0cmluZygpO1xuICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJldHJ5LWJyZWFrcG9pbnRcIikuaW5uZXJUZXh0ID0gcnR5TGVmdC50b0ZpeGVkKDEpO1xufVxuXG5mdW5jdGlvbiBpbml0Rm9ybShuOiBIVE1MRWxlbWVudCkge1xuICBjb25zdCBpbnB1dEZpZWxkcyA9IFtcbiAgICB7XG4gICAgICBuOiBlbFRhZy5JbnB1dCxcbiAgICAgIHY6IFwiQWJFeCBTdGFydFwiLFxuICAgICAgcHJvcHM6IFtcbiAgICAgICAgYnVpbGRQcm9wZXJ0eShcInR5cGVcIiwgSW5wdXQuRGF0ZXRpbWUpLFxuICAgICAgICBidWlsZFByb3BlcnR5KFwiaWRcIiwgXCJhYmV4LWRhdGVcIiksXG4gICAgICBdLFxuICAgIH0sXG4gICAge1xuICAgICAgbjogZWxUYWcuSW5wdXQsXG4gICAgICB2OiBcIkN1cnJlbnQgU3RhbVwiLFxuICAgICAgcHJvcHM6IFtcbiAgICAgICAgYnVpbGRQcm9wZXJ0eShcInR5cGVcIiwgXCJudW1iZXJcIiksXG4gICAgICAgIGJ1aWxkUHJvcGVydHkoXCJpZFwiLCBcImV4LWZvb2RcIiksXG4gICAgICAgIGJ1aWxkUHJvcGVydHkoXCJtaW5cIiwgXCIwXCIpLFxuICAgICAgICBidWlsZFByb3BlcnR5KFwibWF4XCIsIFwiOTk5OVwiKSxcbiAgICAgICAgYnVpbGRQcm9wZXJ0eShcInNpemVcIiwgXCIyMFwiKSxcbiAgICAgICAgYnVpbGRQcm9wZXJ0eShcInZhbHVlXCIsIFwiMFwiKSxcbiAgICAgICAgYnVpbGRQcm9wZXJ0eShcImljb25cIiwgc3RhbSksXG4gICAgICBdLFxuICAgIH0sXG4gICAge1xuICAgICAgbjogZWxUYWcuSW5wdXQsXG4gICAgICB2OiBcIlNwZWN0YXRvcnNcIixcbiAgICAgIHByb3BzOiBbXG4gICAgICAgIGJ1aWxkUHJvcGVydHkoXCJ0eXBlXCIsIFwibnVtYmVyXCIpLFxuICAgICAgICBidWlsZFByb3BlcnR5KFwiaWRcIiwgXCJtaWwtc3BlY3NcIiksXG4gICAgICAgIGJ1aWxkUHJvcGVydHkoXCJtaW5cIiwgXCIwXCIpLFxuICAgICAgICBidWlsZFByb3BlcnR5KFwibWF4XCIsIFwiMTBcIiksXG4gICAgICAgIGJ1aWxkUHJvcGVydHkoXCJzaXplXCIsIFwiMjBcIiksXG4gICAgICAgIGJ1aWxkUHJvcGVydHkoXCJ2YWx1ZVwiLCBcIjBcIiksXG4gICAgICAgIGJ1aWxkUHJvcGVydHkoXCJpY29uXCIsIGFlSWNvbnMuYnBFbnRlciksXG4gICAgICBdLFxuICAgIH0sXG4gICAge1xuICAgICAgbjogZWxUYWcuSW5wdXQsXG4gICAgICB2OiBcIlN0YXIgb2YgRGF3blwiLFxuICAgICAgcHJvcHM6IFtcbiAgICAgICAgYnVpbGRQcm9wZXJ0eShcInR5cGVcIiwgXCJjaGVja2JveFwiKSxcbiAgICAgICAgYnVpbGRQcm9wZXJ0eShcImlkXCIsIFwibWlsLXNvZFwiKSxcbiAgICAgICAgYnVpbGRQcm9wZXJ0eShcImljb25cIiwgYWVJY29ucy5icEVudGVySW1nKSxcbiAgICAgIF0sXG4gICAgfSxcbiAgXTtcbiAgY29uc3Qgb3V0cHV0RmllbGRzID0gW1wiVG90YWwgRm9vZFwiLCBcIkF0dGFja3MgbGVmdFwiLCBcIlJldHJ5IEJyZWFrcG9pbnRcIl07XG4gIGNvbnN0IG91dCA9IGNyZWF0ZUVsZW0oZWxUYWcuRGl2LCBidWlsZFByb3BlcnR5KGVsUHJvcC5DbGFzcywgXCJvdXRib3hcIikpO1xuICBjb25zdCBmb3JtID0gY3JlYXRlRWxlbShlbFRhZy5Gb3JtLCBidWlsZFByb3BlcnR5KGVsUHJvcC5JZCwgXCJhYmV4LWZvcm1cIikpO1xuXG4gIGZvciAoY29uc3QgZmllbGQgb2YgaW5wdXRGaWVsZHMpIHtcbiAgICBmb3JtLmFwcGVuZENoaWxkKGJ1aWxkRWxlbWVudChmaWVsZC5uLCBmaWVsZC5wcm9wcywgZmllbGQudikpO1xuICB9XG5cbiAgZm9yIChjb25zdCBvIG9mIG91dHB1dEZpZWxkcykge1xuICAgIG91dC5hcHBlbmRDaGlsZChcbiAgICAgIGJ1aWxkRWxlbWVudChlbFRhZy5TcGFuLCBbYnVpbGRQcm9wZXJ0eShlbFByb3AuSWQsIGAke2dlbklkKG8pfWApXSwgbylcbiAgICApO1xuICB9XG4gIG4uYXBwZW5kQ2hpbGQoZm9ybSk7XG4gIG4uYXBwZW5kQ2hpbGQob3V0KTtcbn1cblxuZnVuY3Rpb24gaW5wdXRDaGFuZ2UoZTogSFRNTElucHV0RWxlbWVudCkge1xuICBpZiAoZS50eXBlID09PSBcImNoZWNrYm94XCIpIHtcbiAgICBlLmNoZWNrZWQgPyBlLnNldEF0dHJpYnV0ZShcImNoZWNrZWRcIiwgXCJcIikgOiBlLnJlbW92ZUF0dHJpYnV0ZShcImNoZWNrZWRcIik7XG4gIH0gZWxzZSB7XG4gICAgZS5zZXRBdHRyaWJ1dGUoXCJ2YWx1ZVwiLCBlLnZhbHVlKTtcbiAgfVxufVxuIl19