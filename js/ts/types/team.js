import { fetchData, newEl, savedObj, storedValue, } from "../components/helper.js";
import { elTag } from "../model/constants.js";
import { Stamina } from "./abex-resource.js";
import { BossManager } from "./boss.js";
import { Hero } from "./hero.js";
import { Pet } from "./pet.js";
const teamWrap = "team";
const heroSelectId = "hero-selection";
const petSelectId = "pet-sele";
export const rawHeroesData = await fetchData("json/heroes.json");
export const rawBeasts = await fetchData("json/pets.json");
const Heroes = rawHeroesData.map((x) => new Hero(x.id, x.icon, x.heroType, x.heroClass, x.role, x.faction, x.slug));
const puppies = rawBeasts.map((x) => new Pet(x.id, x.icon, x.name));
export class Team {
    team;
    beast;
    target;
    #wrap;
    roster = [];
    _max = 5;
    damage;
    food = new Stamina();
    constructor(mountId, team, beast, target) {
        this.team = team;
        this.beast = beast;
        this.target = target;
        const heroSaved = savedObj("team", []);
        if (heroSaved.length > 0) {
            heroSaved.forEach((v, i) => {
                this.roster.push(new Hero(v.id, v.icon, v.heroType, v.heroClass, v.role, v.faction, v.slug));
            });
        }
        this.beast = savedObj("team-pet", new Pet(0, "1", "0"));
        this.food = savedObj(this.food.name, new Stamina());
        this.init(mountId);
    }
    init(mid) {
        this.#wrap = newEl(elTag.Div, { class: teamWrap });
        const allPets = this.inputsContainer(petSelectId, puppies), allHeroes = this.inputsContainer(heroSelectId, Heroes);
        this.#wrap.appendChild(allPets);
        this.#wrap.appendChild(allHeroes);
        this.#wrap.addEventListener("input", (e) => {
            if (e.target instanceof HTMLInputElement &&
                e.target.className === "beast") {
                this.petHandler(e);
            }
            else {
                this.heroHandler(e);
            }
            this.update();
        });
    }
    update() {
        storedValue("team", this.roster);
        storedValue("team-pet", this.beast);
    }
    isInTeam(hero) {
        return this.roster.findIndex((x) => x.id === hero.id) > -1;
    }
    add(h) {
        if (this.roster?.length < this._max) {
            this.roster.push(h);
            return true;
        }
        else {
            console.log("Team is full!");
            return false;
        }
    }
    remove(h) {
        const idx = this.roster.findIndex((x) => x.id === h.id);
        if (idx > -1) {
            this.roster.splice(idx, 1);
        }
    }
    makeAttack(dmg, c, d) {
        if (this.damage === undefined) {
            this.damage = [];
        }
        if (d) {
            this.food.setValue(this.food.value - BossManager.retry);
        }
        else {
            this.food.setValue(this.food.value - BossManager.foodCost);
        }
        this.damage.push([dmg, c, d]);
        document.getElementById("allowed-retry").innerText = `Attack: ${this.food.BossAttacks()} \nRetry: ${this.food.RetryLimit()}`;
        document.getElementById("avg-dps").innerText = `AVG DPS: ${Math.round(this.damage.map((x) => x[0]).reduce((a, b) => a + b) / this.damage.length)}`;
    }
    inputsContainer(id, data) {
        const container = newEl("div", { class: id });
        container.appendChild(newEl("h2", {}, `CHOOSE ${id.split("-")[0].toUpperCase()}`));
        const ul = document.createElement("ul");
        for (const h of data) {
            const li = document.createElement("li"), checkBox = h.html();
            li.appendChild(checkBox);
            ul.appendChild(li);
            if (h instanceof Pet && this.beast && this.beast.id === h.id) {
                checkBox.getElementsByTagName("input")[0].checked = true;
            }
            if (h instanceof Hero &&
                this.roster.length > 0 &&
                this.roster.findIndex((x) => x.id === h.id) > -1) {
                checkBox.getElementsByTagName("input")[0].checked = true;
            }
        }
        container.appendChild(ul);
        return container;
    }
    heroHandler(e) {
        const tg = e.target;
        const Hero = Heroes.find((x) => x.id === parseInt(tg.id.split("-")[1]));
        if (tg.checked && !this.isInTeam(Hero)) {
            if (!this.add(Hero)) {
                tg.checked = !tg.checked;
            }
        }
        if (!tg.checked && this.isInTeam(Hero)) {
            this.remove(Hero);
        }
    }
    petHandler(e) {
        const tg = e.target;
        const petGroup = document.querySelectorAll(`.${petSelectId} input`);
        const clickedPet = puppies.find((x) => x.name === tg.name);
        petGroup.forEach((x) => {
            if (x.name != clickedPet.name)
                x.checked = false;
        });
        this.beast = clickedPet;
        tg.checked = !tg.checked;
    }
    appendResultRow(body, dps, duraMight, duraFort, duraCelerity, duraSorcery, duraSustenance, c = "", d) {
        const resultRow = newEl(elTag.tr), team = newEl(elTag.td, {}), pet = newEl(elTag.td, {}), might = newEl(elTag.td, {}, `${duraMight}`), fort = newEl(elTag.td, {}, `${duraFort}`), celerity = newEl(elTag.td, {}, `${duraCelerity}`), sorcery = newEl(elTag.td, {}, `${duraSorcery}`), sustenance = newEl(elTag.td, {}, `${duraSustenance}`), comment = newEl(elTag.td, {}, c), damage = newEl(elTag.td, {}, `${dps}B`);
        this.roster.forEach((x) => team.appendChild(x.img()));
        pet.appendChild(this.beast.img());
        if (d) {
            comment.innerText += "discarded attack, retry";
        }
        resultRow.style.verticalAlign = "middle";
        resultRow.appendChild(team);
        resultRow.appendChild(pet);
        resultRow.appendChild(might);
        resultRow.appendChild(fort);
        resultRow.appendChild(celerity);
        resultRow.appendChild(sorcery);
        resultRow.appendChild(sustenance);
        resultRow.appendChild(damage);
        resultRow.appendChild(comment);
        this.makeAttack(dps, c, d);
        body.appendChild(resultRow);
    }
    mount(elId) {
        document.getElementById(elId).appendChild(this.#wrap);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGVhbS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy90eXBlcy90ZWFtLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTCxTQUFTLEVBQ1QsS0FBSyxFQUNMLFFBQVEsRUFDUixXQUFXLEdBQ1osTUFBTSx5QkFBeUIsQ0FBQztBQUNqQyxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDOUMsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQzdDLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFDeEMsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUNqQyxPQUFPLEVBQUUsR0FBRyxFQUFFLE1BQU0sVUFBVSxDQUFDO0FBRS9CLE1BQU0sUUFBUSxHQUFHLE1BQU0sQ0FBQztBQUN4QixNQUFNLFlBQVksR0FBRyxnQkFBZ0IsQ0FBQztBQUN0QyxNQUFNLFdBQVcsR0FBRyxVQUFVLENBQUM7QUFFL0IsTUFBTSxDQUFDLE1BQU0sYUFBYSxHQUFXLE1BQU0sU0FBUyxDQUFDLGtCQUFrQixDQUFDLENBQUM7QUFDekUsTUFBTSxDQUFDLE1BQU0sU0FBUyxHQUFVLE1BQU0sU0FBUyxDQUFDLGdCQUFnQixDQUFDLENBQUM7QUFFbEUsTUFBTSxNQUFNLEdBQVcsYUFBYSxDQUFDLEdBQUcsQ0FDdEMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUNKLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQyxTQUFTLEVBQUUsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FDN0UsQ0FBQztBQUNGLE1BQU0sT0FBTyxHQUFVLFNBQVMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFD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dCI6WyJpbXBvcnQge1xuICBmZXRjaERhdGEsXG4gIG5ld0VsLFxuICBzYXZlZE9iaixcbiAgc3RvcmVkVmFsdWUsXG59IGZyb20gXCIuLi9jb21wb25lbnRzL2hlbHBlci5qc1wiO1xuaW1wb3J0IHsgZWxUYWcgfSBmcm9tIFwiLi4vbW9kZWwvY29uc3RhbnRzLmpzXCI7XG5pbXBvcnQgeyBTdGFtaW5hIH0gZnJvbSBcIi4vYWJleC1yZXNvdXJjZS5qc1wiO1xuaW1wb3J0IHsgQm9zc01hbmFnZXIgfSBmcm9tIFwiLi9ib3NzLmpzXCI7XG5pbXBvcnQgeyBIZXJvIH0gZnJvbSBcIi4vaGVyby5qc1wiO1xuaW1wb3J0IHsgUGV0IH0gZnJvbSBcIi4vcGV0LmpzXCI7XG5cbmNvbnN0IHRlYW1XcmFwID0gXCJ0ZWFtXCI7XG5jb25zdCBoZXJvU2VsZWN0SWQgPSBcImhlcm8tc2VsZWN0aW9uXCI7XG5jb25zdCBwZXRTZWxlY3RJZCA9IFwicGV0LXNlbGVcIjtcblxuZXhwb3J0IGNvbnN0IHJhd0hlcm9lc0RhdGE6IEhlcm9bXSA9IGF3YWl0IGZldGNoRGF0YShcImpzb24vaGVyb2VzLmpzb25cIik7XG5leHBvcnQgY29uc3QgcmF3QmVhc3RzOiBQZXRbXSA9IGF3YWl0IGZldGNoRGF0YShcImpzb24vcGV0cy5qc29uXCIpO1xuXG5jb25zdCBIZXJvZXM6IEhlcm9bXSA9IHJhd0hlcm9lc0RhdGEubWFwKFxuICAoeCkgPT5cbiAgICBuZXcgSGVybyh4LmlkLCB4Lmljb24sIHguaGVyb1R5cGUsIHguaGVyb0NsYXNzLCB4LnJvbGUsIHguZmFjdGlvbiwgeC5zbHVnKVxuKTtcbmNvbnN0IHB1cHBpZXM6IFBldFtdID0gcmF3QmVhc3RzLm1hcCgoeCkgPT4gbmV3IFBldCh4LmlkLCB4Lmljb24sIHgubmFtZSkpO1xuXG5leHBvcnQgY2xhc3MgVGVhbSB7XG4gICN3cmFwOiBIVE1MRWxlbWVudDtcbiAgcm9zdGVyOiBIZXJvW10gPSBbXTtcbiAgcHJpdmF0ZSBfbWF4OiBudW1iZXIgPSA1O1xuICBkYW1hZ2U6IFtudW1iZXIsIHN0cmluZz8sIGJvb2xlYW4/XVtdO1xuXG4gIGZvb2Q6IFN0YW1pbmEgPSBuZXcgU3RhbWluYSgpO1xuXG4gIGNvbnN0cnVjdG9yKG1vdW50SWQ6IHN0cmluZyk7XG4gIGNvbnN0cnVjdG9yKFxuICAgIG1vdW50SWQ6IHN0cmluZyxcbiAgICBwdWJsaWMgdGVhbT86IEhlcm9bXSxcbiAgICBwdWJsaWMgYmVhc3Q/OiBQZXQsXG4gICAgcHVibGljIHRhcmdldD86IHN0cmluZ1xuICApIHtcbiAgICBjb25zdCBoZXJvU2F2ZWQ6IEhlcm9bXSA9IHNhdmVkT2JqKFwidGVhbVwiLCBbXSk7XG4gICAgaWYgKGhlcm9TYXZlZC5sZW5ndGggPiAwKSB7XG4gICAgICBoZXJvU2F2ZWQuZm9yRWFjaCgodiwgaSkgPT4ge1xuICAgICAgICB0aGlzLnJvc3Rlci5wdXNoKFxuICAgICAgICAgIG5ldyBIZXJvKFxuICAgICAgICAgICAgdi5pZCxcbiAgICAgICAgICAgIHYuaWNvbixcbiAgICAgICAgICAgIHYuaGVyb1R5cGUsXG4gICAgICAgICAgICB2Lmhlcm9DbGFzcyxcbiAgICAgICAgICAgIHYucm9sZSxcbiAgICAgICAgICAgIHYuZmFjdGlvbixcbiAgICAgICAgICAgIHYuc2x1Z1xuICAgICAgICAgIClcbiAgICAgICAgKTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHRoaXMuYmVhc3QgPSBzYXZlZE9iaihcInRlYW0tcGV0XCIsIG5ldyBQZXQoMCwgXCIxXCIsIFwiMFwiKSk7XG4gICAgdGhpcy5mb29kID0gc2F2ZWRPYmoodGhpcy5mb29kLm5hbWUsIG5ldyBTdGFtaW5hKCkpO1xuICAgIHRoaXMuaW5pdChtb3VudElkKTtcbiAgfVxuICBpbml0KG1pZDogc3RyaW5nKSB7XG4gICAgdGhpcy4jd3JhcCA9IG5ld0VsKGVsVGFnLkRpdiwgeyBjbGFzczogdGVhbVdyYXAgfSk7XG5cbiAgICBjb25zdCBhbGxQZXRzID0gdGhpcy5pbnB1dHNDb250YWluZXIocGV0U2VsZWN0SWQsIHB1cHBpZXMpLFxuICAgICAgYWxsSGVyb2VzID0gdGhpcy5pbnB1dHNDb250YWluZXIoaGVyb1NlbGVjdElkLCBIZXJvZXMpO1xuICAgIHRoaXMuI3dyYXAuYXBwZW5kQ2hpbGQoYWxsUGV0cyk7XG4gICAgdGhpcy4jd3JhcC5hcHBlbmRDaGlsZChhbGxIZXJvZXMpO1xuXG4gICAgdGhpcy4jd3JhcC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgKGUpID0+IHtcbiAgICAgIGlmIChcbiAgICAgICAgZS50YXJnZXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50ICYmXG4gICAgICAgIGUudGFyZ2V0LmNsYXNzTmFtZSA9PT0gXCJiZWFzdFwiXG4gICAgICApIHtcbiAgICAgICAgdGhpcy5wZXRIYW5kbGVyKGUgYXMgSW5wdXRFdmVudCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmhlcm9IYW5kbGVyKGUgYXMgSW5wdXRFdmVudCk7XG4gICAgICB9XG4gICAgICB0aGlzLnVwZGF0ZSgpO1xuICAgIH0pO1xuICB9XG5cbiAgdXBkYXRlKCkge1xuICAgIHN0b3JlZFZhbHVlKFwidGVhbVwiLCB0aGlzLnJvc3Rlcik7XG4gICAgc3RvcmVkVmFsdWUoXCJ0ZWFtLXBldFwiLCB0aGlzLmJlYXN0KTtcbiAgfVxuICBpc0luVGVhbShoZXJvOiBIZXJvKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMucm9zdGVyLmZpbmRJbmRleCgoeCkgPT4geC5pZCA9PT0gaGVyby5pZCkgPiAtMTtcbiAgfVxuICBhZGQoaDogSGVybykge1xuICAgIGlmICh0aGlzLnJvc3Rlcj8ubGVuZ3RoIDwgdGhpcy5fbWF4KSB7XG4gICAgICB0aGlzLnJvc3Rlci5wdXNoKGgpO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnNvbGUubG9nKFwiVGVhbSBpcyBmdWxsIVwiKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cbiAgcmVtb3ZlKGg6IEhlcm8pIHtcbiAgICBjb25zdCBpZHggPSB0aGlzLnJvc3Rlci5maW5kSW5kZXgoKHgpID0+IHguaWQgPT09IGguaWQpO1xuICAgIGlmIChpZHggPiAtMSkge1xuICAgICAgdGhpcy5yb3N0ZXIuc3BsaWNlKGlkeCwgMSk7XG4gICAgfVxuICB9XG5cbiAgbWFrZUF0dGFjayhkbWc6IG51bWJlciwgYz86IHN0cmluZywgZD86IGJvb2xlYW4pIHtcbiAgICBpZiAodGhpcy5kYW1hZ2UgPT09IHVuZGVmaW5lZCkge1xuICAgICAgdGhpcy5kYW1hZ2UgPSBbXTtcbiAgICB9XG4gICAgaWYgKGQpIHtcbiAgICAgIHRoaXMuZm9vZC5zZXRWYWx1ZSh0aGlzLmZvb2QudmFsdWUgLSBCb3NzTWFuYWdlci5yZXRyeSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuZm9vZC5zZXRWYWx1ZSh0aGlzLmZvb2QudmFsdWUgLSBCb3NzTWFuYWdlci5mb29kQ29zdCk7XG4gICAgfVxuICAgIHRoaXMuZGFtYWdlLnB1c2goW2RtZywgYywgZF0pO1xuXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXG4gICAgICBcImFsbG93ZWQtcmV0cnlcIlxuICAgICkuaW5uZXJUZXh0ID0gYEF0dGFjazogJHt0aGlzLmZvb2QuQm9zc0F0dGFja3MoKX0gXFxuUmV0cnk6ICR7dGhpcy5mb29kLlJldHJ5TGltaXQoKX1gO1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiYXZnLWRwc1wiKS5pbm5lclRleHQgPSBgQVZHIERQUzogJHtNYXRoLnJvdW5kKFxuICAgICAgdGhpcy5kYW1hZ2UubWFwKCh4KSA9PiB4WzBdKS5yZWR1Y2UoKGEsIGIpID0+IGEgKyBiKSAvIHRoaXMuZGFtYWdlLmxlbmd0aFxuICAgICl9YDtcbiAgfVxuXG4gIGlucHV0c0NvbnRhaW5lcihpZDogc3RyaW5nLCBkYXRhOiBIZXJvW10gfCBQZXRbXSkge1xuICAgIGNvbnN0IGNvbnRhaW5lciA9IG5ld0VsKFwiZGl2XCIsIHsgY2xhc3M6IGlkIH0pO1xuICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChcbiAgICAgIG5ld0VsKFwiaDJcIiwge30sIGBDSE9PU0UgJHtpZC5zcGxpdChcIi1cIilbMF0udG9VcHBlckNhc2UoKX1gKVxuICAgICk7XG4gICAgY29uc3QgdWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidWxcIik7XG4gICAgZm9yIChjb25zdCBoIG9mIGRhdGEpIHtcbiAgICAgIGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImxpXCIpLFxuICAgICAgICBjaGVja0JveCA9IGguaHRtbCgpO1xuICAgICAgbGkuYXBwZW5kQ2hpbGQoY2hlY2tCb3gpO1xuICAgICAgdWwuYXBwZW5kQ2hpbGQobGkpO1xuICAgICAgaWYgKGggaW5zdGFuY2VvZiBQZXQgJiYgdGhpcy5iZWFzdCAmJiB0aGlzLmJlYXN0LmlkID09PSBoLmlkKSB7XG4gICAgICAgIGNoZWNrQm94LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiaW5wdXRcIilbMF0uY2hlY2tlZCA9IHRydWU7XG4gICAgICB9XG4gICAgICBpZiAoXG4gICAgICAgIGggaW5zdGFuY2VvZiBIZXJvICYmXG4gICAgICAgIHRoaXMucm9zdGVyLmxlbmd0aCA+IDAgJiZcbiAgICAgICAgdGhpcy5yb3N0ZXIuZmluZEluZGV4KCh4KSA9PiB4LmlkID09PSBoLmlkKSA+IC0xXG4gICAgICApIHtcbiAgICAgICAgY2hlY2tCb3guZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJpbnB1dFwiKVswXS5jaGVja2VkID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHVsKTtcbiAgICByZXR1cm4gY29udGFpbmVyO1xuICB9XG5cbiAgaGVyb0hhbmRsZXIoZTogSW5wdXRFdmVudCkge1xuICAgIGNvbnN0IHRnID0gZS50YXJnZXQgYXMgSFRNTElucHV0RWxlbWVudDtcbiAgICBjb25zdCBIZXJvID0gSGVyb2VzLmZpbmQoKHgpID0+IHguaWQgPT09IHBhcnNlSW50KHRnLmlkLnNwbGl0KFwiLVwiKVsxXSkpO1xuXG4gICAgaWYgKHRnLmNoZWNrZWQgJiYgIXRoaXMuaXNJblRlYW0oSGVybykpIHtcbiAgICAgIGlmICghdGhpcy5hZGQoSGVybykpIHtcbiAgICAgICAgdGcuY2hlY2tlZCA9ICF0Zy5jaGVja2VkO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoIXRnLmNoZWNrZWQgJiYgdGhpcy5pc0luVGVhbShIZXJvKSkge1xuICAgICAgdGhpcy5yZW1vdmUoSGVybyk7XG4gICAgfVxuICB9XG5cbiAgcGV0SGFuZGxlcihlOiBJbnB1dEV2ZW50KSB7XG4gICAgY29uc3QgdGcgPSBlLnRhcmdldCBhcyBIVE1MSW5wdXRFbGVtZW50O1xuICAgIGNvbnN0IHBldEdyb3VwID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChgLiR7cGV0U2VsZWN0SWR9IGlucHV0YCk7XG4gICAgY29uc3QgY2xpY2tlZFBldCA9IHB1cHBpZXMuZmluZCgoeCkgPT4geC5uYW1lID09PSB0Zy5uYW1lKTtcbiAgICBwZXRHcm91cC5mb3JFYWNoKCh4OiBIVE1MSW5wdXRFbGVtZW50KSA9PiB7XG4gICAgICBpZiAoeC5uYW1lICE9IGNsaWNrZWRQZXQubmFtZSkgeC5jaGVja2VkID0gZmFsc2U7XG4gICAgfSk7XG4gICAgdGhpcy5iZWFzdCA9IGNsaWNrZWRQZXQ7XG4gICAgdGcuY2hlY2tlZCA9ICF0Zy5jaGVja2VkO1xuICB9XG5cbiAgYXBwZW5kUmVzdWx0Um93KFxuICAgIGJvZHk6IEhUTUxFbGVtZW50LFxuICAgIGRwczogbnVtYmVyLFxuICAgIGR1cmFNaWdodDogbnVtYmVyLFxuICAgIGR1cmFGb3J0OiBudW1iZXIsXG4gICAgZHVyYUNlbGVyaXR5OiBudW1iZXIsXG4gICAgZHVyYVNvcmNlcnk6IG51bWJlcixcbiAgICBkdXJhU3VzdGVuYW5jZTogbnVtYmVyLFxuICAgIGM6IHN0cmluZyA9IFwiXCIsXG4gICAgZDogYm9vbGVhblxuICApIHtcbiAgICBjb25zdCByZXN1bHRSb3cgPSBuZXdFbChlbFRhZy50ciksXG4gICAgICB0ZWFtID0gbmV3RWwoZWxUYWcudGQsIHt9KSxcbiAgICAgIHBldCA9IG5ld0VsKGVsVGFnLnRkLCB7fSksXG4gICAgICBtaWdodCA9IG5ld0VsKGVsVGFnLnRkLCB7fSwgYCR7ZHVyYU1pZ2h0fWApLFxuICAgICAgZm9ydCA9IG5ld0VsKGVsVGFnLnRkLCB7fSwgYCR7ZHVyYUZvcnR9YCksXG4gICAgICBjZWxlcml0eSA9IG5ld0VsKGVsVGFnLnRkLCB7fSwgYCR7ZHVyYUNlbGVyaXR5fWApLFxuICAgICAgc29yY2VyeSA9IG5ld0VsKGVsVGFnLnRkLCB7fSwgYCR7ZHVyYVNvcmNlcnl9YCksXG4gICAgICBzdXN0ZW5hbmNlID0gbmV3RWwoZWxUYWcudGQsIHt9LCBgJHtkdXJhU3VzdGVuYW5jZX1gKSxcbiAgICAgIGNvbW1lbnQgPSBuZXdFbChlbFRhZy50ZCwge30sIGMpLFxuICAgICAgZGFtYWdlID0gbmV3RWwoZWxUYWcudGQsIHt9LCBgJHtkcHN9QmApO1xuXG4gICAgdGhpcy5yb3N0ZXIuZm9yRWFjaCgoeCkgPT4gdGVhbS5hcHBlbmRDaGlsZCh4LmltZygpKSk7XG4gICAgcGV0LmFwcGVuZENoaWxkKHRoaXMuYmVhc3QuaW1nKCkpO1xuICAgIGlmIChkKSB7XG4gICAgICBjb21tZW50LmlubmVyVGV4dCArPSBcImRpc2NhcmRlZCBhdHRhY2ssIHJldHJ5XCI7XG4gICAgfVxuICAgIHJlc3VsdFJvdy5zdHlsZS52ZXJ0aWNhbEFsaWduID0gXCJtaWRkbGVcIjtcbiAgICByZXN1bHRSb3cuYXBwZW5kQ2hpbGQodGVhbSk7XG4gICAgcmVzdWx0Um93LmFwcGVuZENoaWxkKHBldCk7XG4gICAgcmVzdWx0Um93LmFwcGVuZENoaWxkKG1pZ2h0KTtcbiAgICByZXN1bHRSb3cuYXBwZW5kQ2hpbGQoZm9ydCk7XG4gICAgcmVzdWx0Um93LmFwcGVuZENoaWxkKGNlbGVyaXR5KTtcbiAgICByZXN1bHRSb3cuYXBwZW5kQ2hpbGQoc29yY2VyeSk7XG4gICAgcmVzdWx0Um93LmFwcGVuZENoaWxkKHN1c3RlbmFuY2UpO1xuICAgIHJlc3VsdFJvdy5hcHBlbmRDaGlsZChkYW1hZ2UpO1xuICAgIHJlc3VsdFJvdy5hcHBlbmRDaGlsZChjb21tZW50KTtcblxuICAgIHRoaXMubWFrZUF0dGFjayhkcHMsIGMsIGQpO1xuICAgIGJvZHkuYXBwZW5kQ2hpbGQocmVzdWx0Um93KTtcbiAgfVxuXG4gIG1vdW50KGVsSWQ6IHN0cmluZykge1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGVsSWQpLmFwcGVuZENoaWxkKHRoaXMuI3dyYXApO1xuICB9XG59XG4iXX0=