import { savedObj } from "../components/helper.js";
import { RelicBase } from "../model/constants.js";
import { CoreRelic } from "./relic.js";
import { tier } from "./tier.js";
export class Core {
    rels;
    virtues;
    #baseRelics = {
        MIGHT: [10, 12, 11, 6, 7, 1],
        FORTITUDE: [8, 9, 10, 11, 12, 2],
        CELERITY: [12, 6, 11, 13, 14, 3],
        SORCERY: [14, 9, 13, 15, 16, 4],
        SUSTENANCE: [14, 15, 9, 17, 18, 5],
    };
    #slots = {
        MIGHT: [],
        FORTITUDE: [],
        CELERITY: [],
        SORCERY: [],
        SUSTENANCE: [],
    };
    constructor(rels, virtues) {
        this.rels = rels;
        this.virtues = virtues;
        virtues.forEach((v) => {
            this.#baseRelics[v.dura].forEach((b, i) => {
                const stored = savedObj(`${v.dura}.${i}`, this.CoreRelicById(b, i, v.dura));
                if (stored instanceof CoreRelic) {
                    stored.goal = this.rels.find((x) => x.id === stored.goal.id);
                }
                this.#slots[v.dura].push(stored);
            });
        });
    }
    getById(id) {
        return this.rels.find((r) => r.id === id);
    }
    next(v, i, goal) {
        let slot = this.#slots[v][i];
        if (goal) {
            if (slot.GoalTier() < tier.MYTHIC) {
                this.#slots[v][i].goal = this.getById(slot.goal.id + RelicBase);
            }
            else {
                this.#slots[v][i].goal = this.getById(slot.id);
            }
        }
        else {
            if (slot.Tier() < tier.MYTHIC) {
                this.#slots[v][i] = this.CoreRelicById(slot.id + RelicBase, i, v);
            }
            else {
                this.#slots[v][i] = this.CoreRelicById(this.#baseRelics[v][i], i, v);
            }
        }
        return this.#slots[v][i];
    }
    CoreRelicById(id, i, v) {
        const rel = this.getById(id);
        return new CoreRelic(rel.icon, rel.name, rel.id, rel.cost, rel.recipe, i, v, rel);
    }
    all(virtue) {
        if (virtue) {
            return this.#slots[virtue];
        }
        else {
            return this.virtues.flatMap((v) => this.#slots[v.dura]);
        }
    }
    wanted() {
        return this.all()
            .filter((b) => b.id < b.goal.id)
            .map((j) => j.goal);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29yZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy90eXBlcy9jb3JlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQztBQUNuRCxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDbEQsT0FBYyxFQUFFLFNBQVMsRUFBRSxNQUFNLFlBQVksQ0FBQztBQUM5QyxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBR2pDLE1BQU0sT0FBTyxJQUFJO0lBaUJJO0lBQXNCO0lBaEJ6QyxXQUFXLEdBQUc7UUFDWixLQUFLLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUM1QixTQUFTLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQztRQUNoQyxRQUFRLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQztRQUNoQyxPQUFPLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQztRQUMvQixVQUFVLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQztLQUNuQyxDQUFDO0lBRUYsTUFBTSxHQUFxQztRQUN6QyxLQUFLLEVBQUUsRUFBRTtRQUNULFNBQVMsRUFBRSxFQUFFO1FBQ2IsUUFBUSxFQUFFLEVBQUU7UUFDWixPQUFPLEVBQUUsRUFBRTtRQUNYLFVBQVUsRUFBRSxFQUFFO0tBQ2YsQ0FBQztJQUVGLFlBQW1CLElBQWEsRUFBUyxPQUFp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T0FBTyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQzdCLE9BQU8sSUFBSSxTQUFTLENBQ2xCLEdBQUcsQ0FBQyxJQUFJLEVBQ1IsR0FBRyxDQUFDLElBQUksRUFDUixHQUFHLENBQUMsRUFBRSxFQUNOLEdBQUcsQ0FBQyxJQUFJLEVBQ1IsR0FBRyxDQUFDLE1BQU0sRUFDVixDQUFDLEVBQ0QsQ0FBQyxFQUNELEdBQUcsQ0FDSixDQUFDO0lBQ0osQ0FBQztJQUlELEdBQUcsQ0FBQyxNQUFvQjtRQUN0QixJQUFJLE1BQU0sRUFBRSxDQUFDO1lBQ1gsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQzdCLENBQUM7YUFBTSxDQUFDO1lBQ04sT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztRQUMxRCxDQUFDO0lBQ0gsQ0FBQztJQUVELE1BQU07UUFDSixPQUFPLElBQUksQ0FBQyxHQUFHLEVBQUU7YUFDZCxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUM7YUFDL0IsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDeEIsQ0FBQztDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgc2F2ZWRPYmogfSBmcm9tIFwiLi4vY29tcG9uZW50cy9oZWxwZXIuanNcIjtcbmltcG9ydCB7IFJlbGljQmFzZSB9IGZyb20gXCIuLi9tb2RlbC9jb25zdGFudHMuanNcIjtcbmltcG9ydCBSZWxpYywgeyBDb3JlUmVsaWMgfSBmcm9tIFwiLi9yZWxpYy5qc1wiO1xuaW1wb3J0IHsgdGllciB9IGZyb20gXCIuL3RpZXIuanNcIjtcbmltcG9ydCB7IER1cmFzVmlydHVlLCBWaXJ0dWUgfSBmcm9tIFwiLi92aXJ0dWUuanNcIjtcblxuZXhwb3J0IGNsYXNzIENvcmUge1xuICAjYmFzZVJlbGljcyA9IHtcbiAgICBNSUdIVDogWzEwLCAxMiwgMTEsIDYsIDcsIDFdLFxuICAgIEZPUlRJVFVERTogWzgsIDksIDEwLCAxMSwgMTIsIDJdLFxuICAgIENFTEVSSVRZOiBbMTIsIDYsIDExLCAxMywgMTQsIDNdLFxuICAgIFNPUkNFUlk6IFsxNCwgOSwgMTMsIDE1LCAxNiwgNF0sXG4gICAgU1VTVEVOQU5DRTogWzE0LCAxNSwgOSwgMTcsIDE4LCA1XSxcbiAgfTtcblxuICAjc2xvdHM6IFJlY29yZDxEdXJhc1ZpcnR1ZSwgQ29yZVJlbGljW10+ID0ge1xuICAgIE1JR0hUOiBbXSxcbiAgICBGT1JUSVRVREU6IFtdLFxuICAgIENFTEVSSVRZOiBbXSxcbiAgICBTT1JDRVJZOiBbXSxcbiAgICBTVVNURU5BTkNFOiBbXSxcbiAgfTtcblxuICBjb25zdHJ1Y3RvcihwdWJsaWMgcmVsczogUmVsaWNbXSwgcHVibGljIHZpcnR1ZXM6IFZpcnR1ZVtdKSB7XG4gICAgdmlydHVlcy5mb3JFYWNoKCh2KSA9PiB7XG4gICAgICB0aGlzLiNiYXNlUmVsaWNzW3YuZHVyYV0uZm9yRWFjaCgoYiwgaSkgPT4ge1xuICAgICAgICBjb25zdCBzdG9yZWQgPSBzYXZlZE9iaihcbiAgICAgICAgICBgJHt2LmR1cmF9LiR7aX1gLFxuICAgICAgICAgIHRoaXMuQ29yZVJlbGljQnlJZChiLCBpLCB2LmR1cmEpXG4gICAgICAgICk7XG4gICAgICAgIGlmIChzdG9yZWQgaW5zdGFuY2VvZiBDb3JlUmVsaWMpIHtcbiAgICAgICAgICBzdG9yZWQuZ29hbCA9IHRoaXMucmVscy5maW5kKCh4KSA9PiB4LmlkID09PSBzdG9yZWQuZ29hbC5pZCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy4jc2xvdHNbdi5kdXJhXS5wdXNoKHN0b3JlZCk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIGdldEJ5SWQoaWQ6IG51bWJlcikge1xuICAgIHJldHVybiB0aGlzLnJlbHMuZmluZCgocikgPT4gci5pZCA9PT0gaWQpO1xuICB9XG5cbiAgbmV4dCh2OiBEdXJhc1ZpcnR1ZSwgaTogbnVtYmVyLCBnb2FsPzogYm9vbGVhbikge1xuICAgIGxldCBzbG90ID0gdGhpcy4jc2xvdHNbdl1baV07XG5cbiAgICBpZiAoZ29hbCkge1xuICAgICAgaWYgKHNsb3QuR29hbFRpZXIoKSA8IHRpZXIuTVlUSElDKSB7XG4gICAgICAgIHRoaXMuI3Nsb3RzW3ZdW2ldLmdvYWwgPSB0aGlzLmdldEJ5SWQoc2xvdC5nb2FsLmlkICsgUmVsaWNCYXNlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuI3Nsb3RzW3ZdW2ldLmdvYWwgPSB0aGlzLmdldEJ5SWQoc2xvdC5pZCk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChzbG90LlRpZXIoKSA8IHRpZXIuTVlUSElDKSB7XG4gICAgICAgIHRoaXMuI3Nsb3RzW3ZdW2ldID0gdGhpcy5Db3JlUmVsaWNCeUlkKHNsb3QuaWQgKyBSZWxpY0Jhc2UsIGksIHYpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy4jc2xvdHNbdl1baV0gPSB0aGlzLkNvcmVSZWxpY0J5SWQodGhpcy4jYmFzZVJlbGljc1t2XVtpXSwgaSwgdik7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0aGlzLiNzbG90c1t2XVtpXTtcbiAgfVxuXG4gIENvcmVSZWxpY0J5SWQoaWQ6IG51bWJlciwgaTogbnVtYmVyLCB2OiBEdXJhc1ZpcnR1ZSkge1xuICAgIGNvbnN0IHJlbCA9IHRoaXMuZ2V0QnlJZChpZCk7XG4gICAgcmV0dXJuIG5ldyBDb3JlUmVsaWMoXG4gICAgICByZWwuaWNvbixcbiAgICAgIHJlbC5uYW1lLFxuICAgICAgcmVsLmlkLFxuICAgICAgcmVsLmNvc3QsXG4gICAgICByZWwucmVjaXBlLFxuICAgICAgaSxcbiAgICAgIHYsXG4gICAgICByZWxcbiAgICApO1xuICB9XG5cbiAgYWxsKCk6IENvcmVSZWxpY1tdO1xuICBhbGwodmlydHVlOiBEdXJhc1ZpcnR1ZSk6IENvcmVSZWxpY1tdO1xuICBhbGwodmlydHVlPzogRHVyYXNWaXJ0dWUpOiBDb3JlUmVsaWNbXSB7XG4gICAgaWYgKHZpcnR1ZSkge1xuICAgICAgcmV0dXJuIHRoaXMuI3Nsb3RzW3ZpcnR1ZV07XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB0aGlzLnZpcnR1ZXMuZmxhdE1hcCgodikgPT4gdGhpcy4jc2xvdHNbdi5kdXJhXSk7XG4gICAgfVxuICB9XG5cbiAgd2FudGVkKCk6IFJlbGljW10ge1xuICAgIHJldHVybiB0aGlzLmFsbCgpXG4gICAgICAuZmlsdGVyKChiKSA9PiBiLmlkIDwgYi5nb2FsLmlkKVxuICAgICAgLm1hcCgoaikgPT4gai5nb2FsKTtcbiAgfVxufVxuIl19