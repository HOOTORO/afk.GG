import { verb } from "../model/constants.js";
import { updateResourceBox } from "./output.js";
var elTag;
(function (elTag) {
    elTag["Input"] = "input";
    elTag["Div"] = "div";
    elTag["Span"] = "span";
    elTag["Label"] = "label";
    elTag["Select"] = "select";
    elTag["Option"] = "option";
    elTag["Form"] = "form";
    elTag["Img"] = "img";
})(elTag || (elTag = {}));
var elProp;
(function (elProp) {
    elProp["Id"] = "id";
    elProp["Class"] = "class";
    elProp["For"] = "for";
    elProp["Alt"] = "alt";
    elProp["Src"] = "src";
    elProp["Width"] = "width";
    elProp["Style"] = "style";
    elProp["Type"] = "type";
})(elProp || (elProp = {}));
var Input;
(function (Input) {
    Input["Number"] = "number";
    Input["Text"] = "text";
    Input["CheckBox"] = "checkbox";
    Input["Datetime"] = "datetime-local";
})(Input || (Input = {}));
export const log = (x) => {
    if (verb) {
        console.log(x);
    }
};
function generateAFKResObj(x) {
    const gid = x.toLowerCase().replace(/ /g, "-"), short = x
        .split(" ")
        .map((v, i) => {
        if (i > 0) {
            return v.charAt(0).toLowerCase();
        }
        else {
            return v.toLowerCase().substring(0, 4);
        }
    })
        .join("");
    const br = {
        type: gid,
        label: short,
        img: `../assets/icons/s/${short}.png`,
        amount: 0,
    };
    return br;
}
function setApp(key) {
    const storedVal = localStorage.getItem(key);
    $(`#${key} option[value="${storedVal}"]`).first().attr("selected", "");
}
function populateStorage(key, value) {
    if (key && value) {
        localStorage.setItem(key, value);
        setApp(key);
    }
}
function weekLabels(n, stops) {
    let html = "";
    for (let i = 1; i <= n; i++) {
        if (stops.some((v) => v.n === i)) {
            html += `<option value="${i.toString()}" label="${stops.find((v) => v.n === i)?.desc}"></option>`;
        }
        else {
            html += `<option value="${i.toString()}" label=""></option>`;
        }
    }
    return html;
}
function rangeSlide(value, user) {
    $("rangeValue").html(value + " weeks");
    $(this).attr("value", value?.toString());
    populateStorage("rangeValue", value);
    updateResourceBox(user.income, parseInt(value));
}
function createSelectList(name, options) {
    const list = document.createElement("select");
    list.id = name;
    for (const opt of options) {
        list.appendChild(newEl("option", { value: opt.toString() }, opt.toString()));
    }
    const localVal = storedValue(name);
    if (localVal && options.findIndex((x) => x === localVal) !== -1) {
        list.options.item(options.findIndex((x) => x === localVal)).selected = true;
    }
    else {
        list.options.item(0).setAttribute("selected", "");
    }
    return list;
}
function createInput(fieldType, attrs) {
    attrs["type"] = fieldType;
    return newEl("input", { ...attrs });
}
function savedObj(str, def) {
    if (storedValue(str)) {
        return Object.assign(def, JSON.parse(storedValue(str).toString()));
    }
    return def;
}
export { newEl, newBtn, createInput, createSelectList, generateAFKResObj, hasEmpty as isEmpty, populateStorage, rangeSlide, savedObj, setApp, storedValue, weekLabels, fetchData, buttonWrapInput, elTag, Input, elProp, };
function newEl(tag, props, inner) {
    const doc = document.createElement(tag);
    if (props) {
        Object.entries(props).forEach((k) => {
            doc.setAttribute(k[0], k[1]);
        });
    }
    if (inner) {
        doc.innerHTML = inner;
    }
    return doc;
}
function newBtn(text, c, id) {
    if (!text) {
        text = id;
    }
    return newEl("button", {
        type: "button",
        class: `md-button ${c}`,
    }, text);
}
function storedValue(inputId, value) {
    if (value >= 0 || value) {
        try {
            const str = JSON.stringify(value);
            localStorage.setItem(inputId, str);
        }
        catch (e) {
            console.log(`save error ${e}`);
            return false;
        }
        return true;
    }
    const v = localStorage.getItem(inputId);
    return v ? v : false;
}
function hasEmpty(obj) {
    return (Object.keys(obj).length === 0 &&
        Object.values(obj).some((x) => x === null || x === 0 || x === undefined));
}
export function safeSum(n) {
    if (!hasEmpty(n)) {
        return n.reduce((a, b) => a + b);
    }
}
async function fetchData(assetsPath) {
    const data = await fetch(`/assets/${assetsPath}`);
    const str = await data.text();
    return JSON.parse(str);
}
function buttonWrapInput(el, update) {
    let input = el;
    const wrap = newEl("div", { class: "number-container" }), incBtn = newBtn("<", `desc ${el.className}`), descBtn = newBtn(">", `inc ${el.className}`);
    wrap.appendChild(incBtn);
    wrap.appendChild(el);
    wrap.appendChild(descBtn);
    wrap.addEventListener("click", (e) => {
        if (e.target instanceof HTMLButtonElement) {
            if (e.target.className.includes("desc") && input.valueAsNumber >= 0) {
                input.stepDown();
            }
            else {
                input.stepUp();
            }
            update(input.valueAsNumber);
        }
    });
    input.addEventListener("input", () => {
        update(input.valueAsNumber);
    });
    return wrap;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGVscGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vc3JjL2NvbXBvbmVudHMvaGVscGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBUSxJQUFJLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUVuRCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFFaEQsSUFBSyxLQVdKO0FBWEQsV0FBSyxLQUFLO0lBQ1Isd0JBQWUsQ0FBQTtJQUNmLG9CQUFXLENBQUE7SUFFWCxzQkFBYSxDQUFBO0lBQ2Isd0JBQWUsQ0FBQTtJQUNmLDBCQUFpQixDQUFBO0lBRWpCLDBCQUFpQixDQUFBO0lBQ2pCLHNCQUFhLENBQUE7SUFDYixvQkFBVyxDQUFBO0FBQ2IsQ0FBQyxFQVhJLEtBQUssS0FBTCxLQUFLLFFBV1Q7QUFFRCxJQUFLLE1BU0o7QUFURCxXQUFLLE1BQU07SUFDVCxtQkFBUyxDQUFBO0lBQ1QseUJBQWUsQ0FBQTtJQUNmLHFCQUFXLENBQUE7SUFDWCxxQkFBVyxDQUFBO0lBQ1gscUJBQVcsQ0FBQTtJQUNYLHlCQUFlLENBQUE7SUFDZix5QkFBZSxDQUFBO0lBQ2YsdUJBQWEsQ0FBQTtBQUNmLENBQUMsRUFUSSxNQUFNLEtBQU4sTUFBTSxRQVNWO0FBQ0QsSUFBSyxLQUtKO0FBTEQsV0FBSyxLQUFLO0lBQ1IsMEJBQWlCLENBQUE7SUFDakIsc0JBQWEsQ0FBQTtJQUNiLDhCQUFxQixDQUFBO0lBQ3JCLG9DQUEyQixDQUFBO0FBQzdCLENBQUMsRUFMSSxLQUFLLEtBQUwsS0FBSyxRQUtUO0FBQ0QsTUFBTSxDQUFDLE1BQU0sR0FBRyxHQUFHLENBQUMsQ0FBUyxFQUFFLEVBQUU7SUFDL0IsSUFBSSxJQUFJLEVBQUUsQ0FBQztRQUNULE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDakIsQ0FBQztBQUNILENBQUMsQ0FBQztBQUVGLFNBQVMsaUJBQWlCLENBQUMs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S0FBSyxDQUFDLGFBQWEsSUFBSSxDQUFDLEVBQUUsQ0FBQztnQkFDcEUsS0FBSyxDQUFDLFFBQVEsRUFBRSxDQUFDO1lBQ25CLENBQUM7aUJBQU0sQ0FBQztnQkFDTixLQUFLLENBQUMsTUFBTSxFQUFFLENBQUM7WUFDakIsQ0FBQztZQUNELE1BQU0sQ0FBQyxLQUFLLENBQUMsYUFBYSxDQUFDLENBQUM7UUFDOUIsQ0FBQztJQUNILENBQUMsQ0FBQyxDQUFDO0lBRUgsS0FBSyxDQUFDLGdCQUFnQixDQUFDLE9BQU8sRUFBRSxHQUFHLEVBQUU7UUFDbkMsTUFBTSxDQUFDLEtBQUssQ0FBQyxhQUFhLENBQUMsQ0FBQztJQUM5QixDQUFDLENBQUMsQ0FBQztJQUNILE9BQU8sSUFBSSxDQUFDO0FBQ2QsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGJyZXMsIHZlcmIgfSBmcm9tIFwiLi4vbW9kZWwvY29uc3RhbnRzLmpzXCI7XG5pbXBvcnQgeyBCYXNlUmVzUXR5LCBVc2VyIH0gZnJvbSBcIi4uL21vZGVsL3R5cGVzLmpzXCI7XG5pbXBvcnQgeyB1cGRhdGVSZXNvdXJjZUJveCB9IGZyb20gXCIuL291dHB1dC5qc1wiO1xuXG5lbnVtIGVsVGFnIHtcbiAgSW5wdXQgPSBcImlucHV0XCIsXG4gIERpdiA9IFwiZGl2XCIsXG5cbiAgU3BhbiA9IFwic3BhblwiLFxuICBMYWJlbCA9IFwibGFiZWxcIixcbiAgU2VsZWN0ID0gXCJzZWxlY3RcIixcblxuICBPcHRpb24gPSBcIm9wdGlvblwiLFxuICBGb3JtID0gXCJmb3JtXCIsXG4gIEltZyA9IFwiaW1nXCIsXG59XG5cbmVudW0gZWxQcm9wIHtcbiAgSWQgPSBcImlkXCIsXG4gIENsYXNzID0gXCJjbGFzc1wiLFxuICBGb3IgPSBcImZvclwiLFxuICBBbHQgPSBcImFsdFwiLFxuICBTcmMgPSBcInNyY1wiLFxuICBXaWR0aCA9IFwid2lkdGhcIixcbiAgU3R5bGUgPSBcInN0eWxlXCIsXG4gIFR5cGUgPSBcInR5cGVcIixcbn1cbmVudW0gSW5wdXQge1xuICBOdW1iZXIgPSBcIm51bWJlclwiLFxuICBUZXh0ID0gXCJ0ZXh0XCIsXG4gIENoZWNrQm94ID0gXCJjaGVja2JveFwiLFxuICBEYXRldGltZSA9IFwiZGF0ZXRpbWUtbG9jYWxcIixcbn1cbmV4cG9ydCBjb25zdCBsb2cgPSAoeDogc3RyaW5nKSA9PiB7XG4gIGlmICh2ZXJiKSB7XG4gICAgY29uc29sZS5sb2coeCk7XG4gIH1cbn07XG5cbmZ1bmN0aW9uIGdlbmVyYXRlQUZLUmVzT2JqKHg6IHN0cmluZykge1xuICBjb25zdCBnaWQgPSB4LnRvTG93ZXJDYXNlKCkucmVwbGFjZSgvIC9nLCBcIi1cIiksXG4gICAgc2hvcnQgPSB4XG4gICAgICAuc3BsaXQoXCIgXCIpXG4gICAgICAubWFwKCh2LCBpKSA9PiB7XG4gICAgICAgIGlmIChpID4gMCkge1xuICAgICAgICAgIHJldHVybiB2LmNoYXJBdCgwKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiB2LnRvTG93ZXJDYXNlKCkuc3Vic3RyaW5nKDAsIDQpO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgICAgLmpvaW4oXCJcIik7XG4gIGNvbnN0IGJyOiBCYXNlUmVzUXR5ID0ge1xuICAgIHR5cGU6IGdpZCBhcyBicmVzLFxuICAgIGxhYmVsOiBzaG9ydCxcbiAgICBpbWc6IGAuLi9hc3NldHMvaWNvbnMvcy8ke3Nob3J0fS5wbmdgLFxuICAgIGFtb3VudDogMCxcbiAgfTtcbiAgcmV0dXJuIGJyO1xufVxuXG5mdW5jdGlvbiBzZXRBcHAoa2V5OiBzdHJpbmcpIHtcbiAgY29uc3Qgc3RvcmVkVmFsID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oa2V5KTtcbiAgJChgIyR7a2V5fSBvcHRpb25bdmFsdWU9XCIke3N0b3JlZFZhbH1cIl1gKS5maXJzdCgpLmF0dHIoXCJzZWxlY3RlZFwiLCBcIlwiKTtcbn1cblxuZnVuY3Rpb24gcG9wdWxhdGVTdG9yYWdlKGtleTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nKSB7XG4gIGlmIChrZXkgJiYgdmFsdWUpIHtcbiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShrZXksIHZhbHVlKTtcbiAgICBzZXRBcHAoa2V5KTtcbiAgfVxufVxuXG5mdW5jdGlvbiB3ZWVrTGFiZWxzKG46IG51bWJlciwgc3RvcHM6IHsgbjogbnVtYmVyOyBkZXNjOiBzdHJpbmcgfVtdKSB7XG4gIGxldCBodG1sOiBzdHJpbmcgPSBcIlwiO1xuICBmb3IgKGxldCBpID0gMTsgaSA8PSBuOyBpKyspIHtcbiAgICBpZiAoc3RvcHMuc29tZSgodikgPT4gdi5uID09PSBpKSkge1xuICAgICAgaHRtbCArPSBgPG9wdGlvbiB2YWx1ZT1cIiR7aS50b1N0cmluZygpfVwiIGxhYmVsPVwiJHtcbiAgICAgICAgc3RvcHMuZmluZCgodikgPT4gdi5uID09PSBpKT8uZGVzY1xuICAgICAgfVwiPjwvb3B0aW9uPmA7XG4gICAgfSBlbHNlIHtcbiAgICAgIGh0bWwgKz0gYDxvcHRpb24gdmFsdWU9XCIke2kudG9TdHJpbmcoKX1cIiBsYWJlbD1cIlwiPjwvb3B0aW9uPmA7XG4gICAgfVxuICB9XG4gIHJldHVybiBodG1sO1xufVxuXG5mdW5jdGlvbiByYW5nZVNsaWRlKHZhbHVlOiBzdHJpbmcsIHVzZXI6IFVzZXIpIHtcbiAgJChcInJhbmdlVmFsdWVcIikuaHRtbCh2YWx1ZSArIFwiIHdlZWtzXCIpO1xuICAkKHRoaXMpLmF0dHIoXCJ2YWx1ZVwiLCB2YWx1ZT8udG9TdHJpbmcoKSk7XG4gIHBvcHVsYXRlU3RvcmFnZShcInJhbmdlVmFsdWVcIiwgdmFsdWUpO1xuICB1cGRhdGVSZXNvdXJjZUJveCh1c2VyLmluY29tZSwgcGFyc2VJbnQodmFsdWUpKTtcbn1cblxuZnVuY3Rpb24gY3JlYXRlU2VsZWN0TGlzdChuYW1lOiBzdHJpbmcsIG9wdGlvbnM6IHN0cmluZ1tdIHwgbnVtYmVyW10pIHtcbiAgY29uc3QgbGlzdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzZWxlY3RcIik7XG4gIGxpc3QuaWQgPSBuYW1lO1xuICBmb3IgKGNvbnN0IG9wdCBvZiBvcHRpb25zKSB7XG4gICAgbGlzdC5hcHBlbmRDaGlsZChcbiAgICAgIG5ld0VsKFwib3B0aW9uXCIsIHsgdmFsdWU6IG9wdC50b1N0cmluZygpIH0sIG9wdC50b1N0cmluZygpKVxuICAgICk7XG4gIH1cbiAgY29uc3QgbG9jYWxWYWwgPSBzdG9yZWRWYWx1ZShuYW1lKTtcbiAgaWYgKGxvY2FsVmFsICYmIG9wdGlvbnMuZmluZEluZGV4KCh4KSA9PiB4ID09PSBsb2NhbFZhbCkgIT09IC0xKSB7XG4gICAgbGlzdC5vcHRpb25zLml0ZW0ob3B0aW9ucy5maW5kSW5kZXgoKHgpID0+IHggPT09IGxvY2FsVmFsKSkuc2VsZWN0ZWQgPSB0cnVlO1xuICB9IGVsc2Uge1xuICAgIGxpc3Qub3B0aW9ucy5pdGVtKDApLnNldEF0dHJpYnV0ZShcInNlbGVjdGVkXCIsIFwiXCIpO1xuICB9XG4gIHJldHVybiBsaXN0O1xufVxuXG5mdW5jdGlvbiBjcmVhdGVJbnB1dChmaWVsZFR5cGU6IElucHV0LCBhdHRycz86IHsgW2s6IHN0cmluZ106IHN0cmluZyB9KSB7XG4gIGF0dHJzW1widHlwZVwiXSA9IGZpZWxkVHlwZTtcblxuICByZXR1cm4gbmV3RWwoXCJpbnB1dFwiLCB7IC4uLmF0dHJzIH0pO1xufVxuXG5mdW5jdGlvbiBzYXZlZE9iaihzdHI6IHN0cmluZywgZGVmOiBhbnkpIHtcbiAgaWYgKHN0b3JlZFZhbHVlKHN0cikpIHtcbiAgICByZXR1cm4gT2JqZWN0LmFzc2lnbihkZWYsIEpTT04ucGFyc2Uoc3RvcmVkVmFsdWUoc3RyKS50b1N0cmluZygpKSk7XG4gIH1cbiAgcmV0dXJuIGRlZjtcbn1cblxuZXhwb3J0IHtcbiAgbmV3RWwsXG4gIG5ld0J0bixcbiAgY3JlYXRlSW5wdXQsXG4gIGNyZWF0ZVNlbGVjdExpc3QsXG4gIGdlbmVyYXRlQUZLUmVzT2JqLFxuICBoYXNFbXB0eSBhcyBpc0VtcHR5LFxuICBwb3B1bGF0ZVN0b3JhZ2UsXG4gIHJhbmdlU2xpZGUsXG4gIHNhdmVkT2JqLFxuICBzZXRBcHAsXG4gIHN0b3JlZFZhbHVlLFxuICB3ZWVrTGFiZWxzLFxuICBmZXRjaERhdGEsXG4gIGJ1dHRvbldyYXBJbnB1dCxcbiAgZWxUYWcsXG4gIElucHV0LFxuICBlbFByb3AsXG59O1xuXG5mdW5jdGlvbiBuZXdFbCh0YWc6IHN0cmluZywgcHJvcHM/OiB7IFtrOiBzdHJpbmddOiBzdHJpbmcgfSwgaW5uZXI/OiBzdHJpbmcpIHtcbiAgY29uc3QgZG9jID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuICBpZiAocHJvcHMpIHtcbiAgICBPYmplY3QuZW50cmllcyhwcm9wcykuZm9yRWFjaCgoaykgPT4ge1xuICAgICAgZG9jLnNldEF0dHJpYnV0ZShrWzBdLCBrWzFdKTtcbiAgICB9KTtcbiAgfVxuICBpZiAoaW5uZXIpIHtcbiAgICBkb2MuaW5uZXJIVE1MID0gaW5uZXI7XG4gIH1cbiAgcmV0dXJuIGRvYztcbn1cblxuZnVuY3Rpb24gbmV3QnRuKHRleHQ/OiBzdHJpbmcsIGM/OiBzdHJpbmcsIGlkPzogc3RyaW5nKSB7XG4gIGlmICghdGV4dCkge1xuICAgIHRleHQgPSBpZDtcbiAgfVxuICByZXR1cm4gbmV3RWwoXG4gICAgXCJidXR0b25cIixcbiAgICB7XG4gICAgICB0eXBlOiBcImJ1dHRvblwiLFxuICAgICAgY2xhc3M6IGBtZC1idXR0b24gJHtjfWAsXG4gICAgICAvLyBpZDogaWQsXG4gICAgfSxcbiAgICB0ZXh0XG4gICk7XG59XG5cbmZ1bmN0aW9uIHN0b3JlZFZhbHVlKGlucHV0SWQ6IHN0cmluZywgdmFsdWU/OiBhbnkpOiBib29sZWFuIHwgc3RyaW5nIHtcbiAgaWYgKHZhbHVlID49IDAgfHwgdmFsdWUpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3Qgc3RyID0gSlNPTi5zdHJpbmdpZnkodmFsdWUpO1xuICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oaW5wdXRJZCwgc3RyKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBjb25zb2xlLmxvZyhgc2F2ZSBlcnJvciAke2V9YCk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIGNvbnN0IHYgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShpbnB1dElkKTtcbiAgcmV0dXJuIHYgPyB2IDogZmFsc2U7XG59XG5cbmZ1bmN0aW9uIGhhc0VtcHR5KG9iajogUmVjb3JkPHN0cmluZywgYW55Pik6IGJvb2xlYW4ge1xuICByZXR1cm4gKFxuICAgIE9iamVjdC5rZXlzKG9iaikubGVuZ3RoID09PSAwICYmXG4gICAgT2JqZWN0LnZhbHVlcyhvYmopLnNvbWUoKHgpID0+IHggPT09IG51bGwgfHwgeCA9PT0gMCB8fCB4ID09PSB1bmRlZmluZWQpXG4gICk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzYWZlU3VtKG46IG51bWJlcltdKSB7XG4gIGlmICghaGFzRW1wdHkobikpIHtcbiAgICByZXR1cm4gbi5yZWR1Y2UoKGEsIGIpID0+IGEgKyBiKTtcbiAgfVxufVxuXG5hc3luYyBmdW5jdGlvbiBmZXRjaERhdGEoYXNzZXRzUGF0aDogc3RyaW5nKSB7XG4gIGNvbnN0IGRhdGEgPSBhd2FpdCBmZXRjaChgL2Fzc2V0cy8ke2Fzc2V0c1BhdGh9YCk7XG4gIGNvbnN0IHN0ciA9IGF3YWl0IGRhdGEudGV4dCgpO1xuICByZXR1cm4gSlNPTi5wYXJzZShzdHIpO1xufVxuXG5mdW5jdGlvbiBidXR0b25XcmFwSW5wdXQoZWw6IEhUTUxFbGVtZW50LCB1cGRhdGU6ICh5OiBudW1iZXIpID0+IHZvaWQpIHtcbiAgbGV0IGlucHV0ID0gZWwgYXMgSFRNTElucHV0RWxlbWVudDtcblxuICBjb25zdCB3cmFwID0gbmV3RWwoXCJkaXZcIiwgeyBjbGFzczogXCJudW1iZXItY29udGFpbmVyXCIgfSksXG4gICAgLy8gaW5jQnRuID0gbmV3QnRuKFwi4peA77iPXCIsIGBkZXNjICR7ZWwuY2xhc3NOYW1lfWApLFxuICAgIGluY0J0biA9IG5ld0J0bihcIjxcIiwgYGRlc2MgJHtlbC5jbGFzc05hbWV9YCksXG4gICAgLy8gZGVzY0J0biA9IG5ld0J0bihcIuKWtu+4j1wiLCBgaW5jICR7ZWwuY2xhc3NOYW1lfWApO1xuICAgIGRlc2NCdG4gPSBuZXdCdG4oXCI+XCIsIGBpbmMgJHtlbC5jbGFzc05hbWV9YCk7XG4gIHdyYXAuYXBwZW5kQ2hpbGQoaW5jQnRuKTtcbiAgd3JhcC5hcHBlbmRDaGlsZChlbCk7XG4gIHdyYXAuYXBwZW5kQ2hpbGQoZGVzY0J0bik7XG4gIHdyYXAuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChlOiBNb3VzZUV2ZW50KSA9PiB7XG4gICAgaWYgKGUudGFyZ2V0IGluc3RhbmNlb2YgSFRNTEJ1dHRvbkVsZW1lbnQpIHtcbiAgICAgIGlmIChlLnRhcmdldC5jbGFzc05hbWUuaW5jbHVkZXMoXCJkZXNjXCIpICYmIGlucHV0LnZhbHVlQXNOdW1iZXIgPj0gMCkge1xuICAgICAgICBpbnB1dC5zdGVwRG93bigpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaW5wdXQuc3RlcFVwKCk7XG4gICAgICB9XG4gICAgICB1cGRhdGUoaW5wdXQudmFsdWVBc051bWJlcik7XG4gICAgfVxuICB9KTtcblxuICBpbnB1dC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgKCkgPT4ge1xuICAgIHVwZGF0ZShpbnB1dC52YWx1ZUFzTnVtYmVyKTtcbiAgfSk7XG4gIHJldHVybiB3cmFwO1xufVxuIl19