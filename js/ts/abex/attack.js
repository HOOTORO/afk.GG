import { expeditor, team } from "../abex.js";
import { elBuilder } from "../components/builder.js";
import { exportToCsv } from "../components/csvexport.js";
import { newEl, newIn, newBtn } from "../components/helper.js";
import { elTag, Input } from "../model/constants.js";
import { Virtues } from "../types/virtue.js";
const outputTableId = "dps-table";
export function AttackForm() {
    const c = "attack-inputs", dataColumns = [
        "Team",
        "Pet",
        ...expeditor.DuraTree.map((x) => x.img().outerHTML),
        "Damage",
        "Comment",
    ];
    const addAttack = newBtn("Add Dmg", "add-attack md-button"), csvExport = newBtn("Export", "export-csv md-button"), treeDiv = newEl("div", { class: `team-set-inputs` });
    treeDiv.appendChild(team.food.html());
    expeditor.DuraTree.forEach((x) => {
        treeDiv.appendChild(x.html());
    });
    const btnContainer = new elBuilder(elTag.Label)
        .add(addAttack)
        .add(csvExport)
        .html(), dpsLabel = new elBuilder(elTag.Label, { for: "dps" }, "Damage, B.")
        .add(newIn(Input.Number, { class: `${c}__input`, id: "dps", step: "1000" }))
        .add(newEl(elTag.Span, { id: "allowed-retry", class: "calculated" }))
        .html(), comLabel = new elBuilder(elTag.Label, { for: "comm" }, "Comment")
        .add(newIn(Input.Text, { class: `${c}__input`, id: "comm" }))
        .add(newEl(elTag.Span, { id: "avg-dps", class: "calculated" }))
        .html(), retryLabel = new elBuilder(elTag.Label, { for: "dis-flag" }, "Discarded?")
        .add(newIn(Input.CheckBox, { class: `${c}__input`, id: "dis-flag" }))
        .html();
    const atkF = new elBuilder(elTag.Form, {
        class: "team-set-inputs",
        id: "team-attacks-form",
    })
        .add(dpsLabel)
        .add(comLabel)
        .add(retryLabel)
        .add(btnContainer)
        .html();
    const atkC = new elBuilder(elTag.Div, { class: c })
        .add(atkF)
        .add(newEl("h2", {}, "Set Food & Dura Tree"))
        .add(treeDiv)
        .html();
    document.getElementById("attack-app").appendChild(atkC);
    team.mount("team-set");
    const header = document
        .getElementById("team-attacks-form")
        .appendChild(newEl(elTag.Table, {
        id: outputTableId,
        class: "dps",
        style: "width:100%",
    }))
        .appendChild(newEl(elTag.Thead))
        .appendChild(newEl(elTag.tr));
    const body = document
        .getElementById("dps-table")
        .appendChild(newEl(elTag.Tbody));
    dataColumns.forEach((x) => header.appendChild(newEl(elTag.th, {}, x)));
    const dpsField = document.getElementById("dps");
    const commentField = document.getElementById("comm");
    const discarded = document.getElementById("dis-flag");
    csvExport.addEventListener("click", (e) => {
        const o = team.damage.map((x) => [
            team.roster.map((y) => y.name).join("|"),
            team.beast.name,
            ...expeditor.DuraTree.map((v) => `${v.value}`),
            x[0].toString(),
            x[1].toString(),
        ]);
        exportToCsv("data.csv", o, dataColumns);
    });
    addAttack.addEventListener("click", (e) => {
        const tree = newEl(elTag.Div);
        expeditor.DuraTree.forEach((x) => {
            tree.appendChild(x.img());
            tree.innerHTML += `:${x.value}`;
        });
        team.appendResultRow(body, dpsField.valueAsNumber, expeditor.DuraTree[Virtues.MIGHT].value, expeditor.DuraTree[Virtues.FORTITUDE].value, expeditor.DuraTree[Virtues.CELERITY].value, expeditor.DuraTree[Virtues.SORCERY].value, expeditor.DuraTree[Virtues.SUSTENANCE].value, commentField.value, discarded.checked);
    });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXR0YWNrLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vc3JjL2FiZXgvYXR0YWNrLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFLE1BQU0sWUFBWSxDQUFDO0FBQzdDLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUNyRCxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFDekQsT0FBTyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFDL0QsT0FBTyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUNyRCxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFFN0MsTUFBTSxhQUFhLEdBQUcsV0FBVyxDQUFDO0FBRWxDLE1BQU0sVUFBVSxVQUFVO0lBQ3hCLE1BQU0sQ0FBQyxHQUFHLGVBQWUsRUFDdkIsV0FBVyxHQUFHO1FBQ1osTUFBTTtRQUNOLEtBQUs7UUFDTCxHQUFHLFNBQVMsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsU0FBUyxDQUFDO1FBQ25ELFFBQVE7UUFDUixTQUFTO0tBQ1YsQ0FBQztJQUVKLE1BQU0sU0FBUyxHQUFHLE1BQU0sQ0FBQyxTQUFTLEVBQUUsc0JBQXNCLENBQUMsRUFDekQsU0FBUyxHQUFHLE1BQU0sQ0FBQyxRQUFRLEVBQUUsc0JBQXNCLENBQUMsRUFDcEQsT0FBTyxHQUFHLEtBQUssQ0FBQyxLQUFLLEVBQUUsRUFBRSxLQUFLLEVBQUUsaUJBQWlCLEVBQUUsQ0FBQyxDQUFDO0lBRXZELE9BQU8sQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDO0lBQ3RDLFNBQVMsQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUU7UUFDL0IsT0FBTyxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQztJQUNoQyxDQUFDLENBQUMsQ0FBQztJQUVILE1BQU0sWUFBWSxHQUFHLElBQUksU0FBUyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUM7U0FDMUMsR0FBRyxDQUFDLFNBQVMsQ0FBQztTQUNkLEdBQUcsQ0FBQyxTQUFTLENBQUM7U0FDZCxJQUFJLEVBQUUsRUFDVCxRQUFRLEdBQUcsSUFBSSxTQUFTLENBQUMsS0FBSyxDQUFDLEtBQUssRUFBRSxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUUsRUFBRSxZQUFZLENBQUM7U0FDaEUsR0FBRyxDQUNGLEtBQUssQ0FBQyxLQUFLLENBQUMsTUFBTSxFQUFFLEVBQUUsS0FBSyxFQUFFLEdBQUcsQ0FBQyxTQUFTLEVBQUUsRUFBRSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLENBQUMsQ0FDdkU7U0FDQSxHQUFHLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsRUFBRSxFQUFFLEVBQUUsZUFBZSxFQUFFLEtBQUssRUFBRSxZQUFZLEVBQUUsQ0FBQyxDQUFDO1NBQ3BFLElBQUksRUFBRSxFQUNULFFBQVEsR0FBRyxJQUFJLFNBQVMsQ0FBQyxLQUFLLENBQUMsS0FBSyxFQUFFLEVBQUUsR0FBRyxFQUFFLE1BQU0sRUFBRSxFQUFFLFNBQVMsQ0FBQztTQUM5RCxHQUFHLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsRUFBRSxLQUFLLEVBQUUsR0FBRyxDQUFDLFNBQVMsRUFBRSxFQUFFLEVBQUUsTUFBTSxFQUFFLENBQUMsQ0FBQztTQUM1RCxHQUFHLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsRUFBRSxFQUFFLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxZQUFZLEVBQUUsQ0FBQyxDQUFDO1NBQzlELElBQUksRUFBRSxFQUNULFVBQVUsR0FBRyxJQUFJLFNBQVMsQ0FBQyxLQUFLLENBQUMsS0FBSyxFQUFFLEVBQUUsR0FBRyxFQUFFLFVBQVUsRUFBRSxFQUFFLFlBQVksQ0FBQztTQUN2RSxHQUFHLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxRQUFRLEVBQUUsRUFBRSxLQUFLLEVBQUUsR0FBRyxDQUFDLFNBQVMsRUFBRSxFQUFFLEVBQUUsVUFBVSxFQUFFLENBQUMsQ0FBQztTQUNwRSxJQUFJLEVBQUUsQ0FBQztJQUVaLE1BQU0sSUFBSSxHQUFHLElBQUksU0FBUyxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUU7UUFDckMsS0FBSyxFQUFFLGlCQUFpQjtRQUN4QixFQUFFLEVBQUUsbUJBQW1CO0tBQ3hCLENBQUM7U0FDQyxHQUFHLENBQUMsUUFBUSxDQUFDO1NBQ2IsR0FBRyxDQUFDLFFBQVEsQ0FBQztTQUNiLEdBQUcsQ0FBQyxVQUFVLENBQUM7U0FDZixHQUFHLENBQUMsWUFBWSxDQUFDO1NBQ2pCLElBQUksRUFBRSxDQUFDO0lBRVYsTUFBTSxJQUFJLEdBQUcsSUFBSSxTQUFTLENBQUMsS0FBSyxDQUFDLEdBQUcsRUFBRSxFQUFFLEtBQUssRUFBRSxDQUFDLEVBQUUsQ0FBQztTQUNoRCxHQUFHLENBQUMsSUFBSSxDQUFDO1NBQ1QsR0FBRyxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsRUFBRSxFQUFFLHNCQUFzQixDQUFDLENBQUM7U0FDNUMsR0FBRyxDQUFDLE9BQU8sQ0FBQztTQUNaLElBQUksRUFBRSxDQUFDO0lBRVYsUUFBUSxDQUFDLGNBQWMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDeEQsSUFBSSxDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUMsQ0FBQztJQUV2QixNQUFNLE1BQU0sR0FBRyxRQUFRO1NBQ3BCLGNBQWMsQ0FBQyxtQkFBbUIsQ0FBQztTQUNuQyxXQUFXLENBQ1YsS0FBSyxDQUFDLEtBQUssQ0FBQyxLQUFLLEVBQUU7UUFDakIsRUFBRSxFQUFFLGFBQWE7UUFDakIsS0FBSyxFQUFFLEtBQUs7UUFDWixLQUFLLEVBQUUsWUFBWTtLQUNwQixDQUFDLENBQ0g7U0FDQSxXQUFXLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQztTQUMvQixXQUFXLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQ2hDLE1BQU0sSUFBSSxHQUFHLFFBQVE7U0FDbEIsY0FBYyxDQUFDLFdBQVcsQ0FBQztTQUMzQixXQUFXLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO0lBQ25DLFdBQVcsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUV2RSxNQUFNLFFBQVEsR0FBRyxRQUFRLENBQUMsY0FBYyxDQUFDLEtBQUssQ0FBcUIsQ0FBQztJQUNwRSxNQUFNLFlBQVksR0FBRyxRQUFRLENBQUMsY0FBYyxDQUFDLE1BQU0sQ0FBcUIsQ0FBQztJQUN6RSxNQUFNLFNBQVMsR0FBRyxRQUFRLENBQUMsY0FBYyxDQUFDLFVBQVUsQ0FBcUIsQ0FBQztJQUUxRSxTQUFTLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQUU7UUFDeEMsTUFBTSxDQUFDLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDO1lBQy9CLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQztZQUN4QyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUk7WUFDZixHQUFHLFNBQVMsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxLQUFLLEVBQUUsQ0FBQztZQUM5QyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxFQUFFO1lBQ2YsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsRUFBRTtTQUNoQixDQUFDLENBQUM7UUFDSCxXQUFXLENBQUMsVUFBVSxFQUFFLENBQUMsRUFBRSxXQUFXLENBQUMsQ0FBQztJQUMxQyxDQUFDLENBQUMsQ0FBQztJQUVILFNBQVMsQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDLEVBQUUsRUFBRTtRQUN4QyxNQUFNLElBQUksR0FBRyxLQUFLLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQzlCLFNBQVMsQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUU7WUFDL0IsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztZQUMxQixJQUFJLENBQUMsU0FBUyxJQUFJLElBQUksQ0FBQyxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQ2xDLENBQUMsQ0FBQyxDQUFDO1FBRUgsSUFBSSxDQUFDLGVBQWUsQ0FDbEIsSUFBSSxFQUNKLFFBQVEsQ0FBQyxhQUFhLEVBQ3RCLFNBQVMsQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDLEtBQUssRUFDdkMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUMsS0FBSyxFQUMzQyxTQUFTLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQyxLQUFLLEVBQzFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDLEtBQUssRUFDekMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLENBQUMsS0FBSyxFQUM1QyxZQUFZLENBQUMsS0FBSyxFQUNsQixTQUFTLENBQUMsT0FBTyxDQUNsQixDQUFDO0lBQ0osQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZXhwZWRpdG9yLCB0ZWFtIH0gZnJvbSBcIi4uL2FiZXguanNcIjtcbmltcG9ydCB7IGVsQnVpbGRlciB9IGZyb20gXCIuLi9jb21wb25lbnRzL2J1aWxkZXIuanNcIjtcbmltcG9ydCB7IGV4cG9ydFRvQ3N2IH0gZnJvbSBcIi4uL2NvbXBvbmVudHMvY3N2ZXhwb3J0LmpzXCI7XG5pbXBvcnQgeyBuZXdFbCwgbmV3SW4sIG5ld0J0biB9IGZyb20gXCIuLi9jb21wb25lbnRzL2hlbHBlci5qc1wiO1xuaW1wb3J0IHsgZWxUYWcsIElucHV0IH0gZnJvbSBcIi4uL21vZGVsL2NvbnN0YW50cy5qc1wiO1xuaW1wb3J0IHsgVmlydHVlcyB9IGZyb20gXCIuLi90eXBlcy92aXJ0dWUuanNcIjtcblxuY29uc3Qgb3V0cHV0VGFibGVJZCA9IFwiZHBzLXRhYmxlXCI7XG5cbmV4cG9ydCBmdW5jdGlvbiBBdHRhY2tGb3JtKCkge1xuICBjb25zdCBjID0gXCJhdHRhY2staW5wdXRzXCIsXG4gICAgZGF0YUNvbHVtbnMgPSBbXG4gICAgICBcIlRlYW1cIixcbiAgICAgIFwiUGV0XCIsXG4gICAgICAuLi5leHBlZGl0b3IuRHVyYVRyZWUubWFwKCh4KSA9PiB4LmltZygpLm91dGVySFRNTCksXG4gICAgICBcIkRhbWFnZVwiLFxuICAgICAgXCJDb21tZW50XCIsXG4gICAgXTtcblxuICBjb25zdCBhZGRBdHRhY2sgPSBuZXdCdG4oXCJBZGQgRG1nXCIsIFwiYWRkLWF0dGFjayBtZC1idXR0b25cIiksXG4gICAgY3N2RXhwb3J0ID0gbmV3QnRuKFwiRXhwb3J0XCIsIFwiZXhwb3J0LWNzdiBtZC1idXR0b25cIiksXG4gICAgdHJlZURpdiA9IG5ld0VsKFwiZGl2XCIsIHsgY2xhc3M6IGB0ZWFtLXNldC1pbnB1dHNgIH0pO1xuXG4gIHRyZWVEaXYuYXBwZW5kQ2hpbGQodGVhbS5mb29kLmh0bWwoKSk7XG4gIGV4cGVkaXRvci5EdXJhVHJlZS5mb3JFYWNoKCh4KSA9PiB7XG4gICAgdHJlZURpdi5hcHBlbmRDaGlsZCh4Lmh0bWwoKSk7XG4gIH0pO1xuXG4gIGNvbnN0IGJ0bkNvbnRhaW5lciA9IG5ldyBlbEJ1aWxkZXIoZWxUYWcuTGFiZWwpXG4gICAgICAuYWRkKGFkZEF0dGFjaylcbiAgICAgIC5hZGQoY3N2RXhwb3J0KVxuICAgICAgLmh0bWwoKSxcbiAgICBkcHNMYWJlbCA9IG5ldyBlbEJ1aWxkZXIoZWxUYWcuTGFiZWwsIHsgZm9yOiBcImRwc1wiIH0sIFwiRGFtYWdlLCBCLlwiKVxuICAgICAgLmFkZChcbiAgICAgICAgbmV3SW4oSW5wdXQuTnVtYmVyLCB7IGNsYXNzOiBgJHtjfV9faW5wdXRgLCBpZDogXCJkcHNcIiwgc3RlcDogXCIxMDAwXCIgfSlcbiAgICAgIClcbiAgICAgIC5hZGQobmV3RWwoZWxUYWcuU3BhbiwgeyBpZDogXCJhbGxvd2VkLXJldHJ5XCIsIGNsYXNzOiBcImNhbGN1bGF0ZWRcIiB9KSlcbiAgICAgIC5odG1sKCksXG4gICAgY29tTGFiZWwgPSBuZXcgZWxCdWlsZGVyKGVsVGFnLkxhYmVsLCB7IGZvcjogXCJjb21tXCIgfSwgXCJDb21tZW50XCIpXG4gICAgICAuYWRkKG5ld0luKElucHV0LlRleHQsIHsgY2xhc3M6IGAke2N9X19pbnB1dGAsIGlkOiBcImNvbW1cIiB9KSlcbiAgICAgIC5hZGQobmV3RWwoZWxUYWcuU3BhbiwgeyBpZDogXCJhdmctZHBzXCIsIGNsYXNzOiBcImNhbGN1bGF0ZWRcIiB9KSlcbiAgICAgIC5odG1sKCksXG4gICAgcmV0cnlMYWJlbCA9IG5ldyBlbEJ1aWxkZXIoZWxUYWcuTGFiZWwsIHsgZm9yOiBcImRpcy1mbGFnXCIgfSwgXCJEaXNjYXJkZWQ/XCIpXG4gICAgICAuYWRkKG5ld0luKElucHV0LkNoZWNrQm94LCB7IGNsYXNzOiBgJHtjfV9faW5wdXRgLCBpZDogXCJkaXMtZmxhZ1wiIH0pKVxuICAgICAgLmh0bWwoKTtcblxuICBjb25zdCBhdGtGID0gbmV3IGVsQnVpbGRlcihlbFRhZy5Gb3JtLCB7XG4gICAgY2xhc3M6IFwidGVhbS1zZXQtaW5wdXRzXCIsXG4gICAgaWQ6IFwidGVhbS1hdHRhY2tzLWZvcm1cIixcbiAgfSlcbiAgICAuYWRkKGRwc0xhYmVsKVxuICAgIC5hZGQoY29tTGFiZWwpXG4gICAgLmFkZChyZXRyeUxhYmVsKVxuICAgIC5hZGQoYnRuQ29udGFpbmVyKVxuICAgIC5odG1sKCk7XG5cbiAgY29uc3QgYXRrQyA9IG5ldyBlbEJ1aWxkZXIoZWxUYWcuRGl2LCB7IGNsYXNzOiBjIH0pXG4gICAgLmFkZChhdGtGKVxuICAgIC5hZGQobmV3RWwoXCJoMlwiLCB7fSwgXCJTZXQgRm9vZCAmIER1cmEgVHJlZVwiKSlcbiAgICAuYWRkKHRyZWVEaXYpXG4gICAgLmh0bWwoKTtcblxuICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImF0dGFjay1hcHBcIikuYXBwZW5kQ2hpbGQoYXRrQyk7XG4gIHRlYW0ubW91bnQoXCJ0ZWFtLXNldFwiKTtcblxuICBjb25zdCBoZWFkZXIgPSBkb2N1bWVudFxuICAgIC5nZXRFbGVtZW50QnlJZChcInRlYW0tYXR0YWNrcy1mb3JtXCIpXG4gICAgLmFwcGVuZENoaWxkKFxuICAgICAgbmV3RWwoZWxUYWcuVGFibGUsIHtcbiAgICAgICAgaWQ6IG91dHB1dFRhYmxlSWQsXG4gICAgICAgIGNsYXNzOiBcImRwc1wiLFxuICAgICAgICBzdHlsZTogXCJ3aWR0aDoxMDAlXCIsXG4gICAgICB9KVxuICAgIClcbiAgICAuYXBwZW5kQ2hpbGQobmV3RWwoZWxUYWcuVGhlYWQpKVxuICAgIC5hcHBlbmRDaGlsZChuZXdFbChlbFRhZy50cikpO1xuICBjb25zdCBib2R5ID0gZG9jdW1lbnRcbiAgICAuZ2V0RWxlbWVudEJ5SWQoXCJkcHMtdGFibGVcIilcbiAgICAuYXBwZW5kQ2hpbGQobmV3RWwoZWxUYWcuVGJvZHkpKTtcbiAgZGF0YUNvbHVtbnMuZm9yRWFjaCgoeCkgPT4gaGVhZGVyLmFwcGVuZENoaWxkKG5ld0VsKGVsVGFnLnRoLCB7fSwgeCkpKTtcblxuICBjb25zdCBkcHNGaWVsZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZHBzXCIpIGFzIEhUTUxJbnB1dEVsZW1lbnQ7XG4gIGNvbnN0IGNvbW1lbnRGaWVsZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiY29tbVwiKSBhcyBIVE1MSW5wdXRFbGVtZW50O1xuICBjb25zdCBkaXNjYXJkZWQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImRpcy1mbGFnXCIpIGFzIEhUTUxJbnB1dEVsZW1lbnQ7XG5cbiAgY3N2RXhwb3J0LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgIGNvbnN0IG8gPSB0ZWFtLmRhbWFnZS5tYXAoKHgpID0+IFtcbiAgICAgIHRlYW0ucm9zdGVyLm1hcCgoeSkgPT4geS5uYW1lKS5qb2luKFwifFwiKSxcbiAgICAgIHRlYW0uYmVhc3QubmFtZSxcbiAgICAgIC4uLmV4cGVkaXRvci5EdXJhVHJlZS5tYXAoKHYpID0+IGAke3YudmFsdWV9YCksXG4gICAgICB4WzBdLnRvU3RyaW5nKCksXG4gICAgICB4WzFdLnRvU3RyaW5nKCksXG4gICAgXSk7XG4gICAgZXhwb3J0VG9Dc3YoXCJkYXRhLmNzdlwiLCBvLCBkYXRhQ29sdW1ucyk7XG4gIH0pO1xuXG4gIGFkZEF0dGFjay5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICBjb25zdCB0cmVlID0gbmV3RWwoZWxUYWcuRGl2KTtcbiAgICBleHBlZGl0b3IuRHVyYVRyZWUuZm9yRWFjaCgoeCkgPT4ge1xuICAgICAgdHJlZS5hcHBlbmRDaGlsZCh4LmltZygpKTtcbiAgICAgIHRyZWUuaW5uZXJIVE1MICs9IGA6JHt4LnZhbHVlfWA7XG4gICAgfSk7XG5cbiAgICB0ZWFtLmFwcGVuZFJlc3VsdFJvdyhcbiAgICAgIGJvZHksXG4gICAgICBkcHNGaWVsZC52YWx1ZUFzTnVtYmVyLFxuICAgICAgZXhwZWRpdG9yLkR1cmFUcmVlW1ZpcnR1ZXMuTUlHSFRdLnZhbHVlLFxuICAgICAgZXhwZWRpdG9yLkR1cmFUcmVlW1ZpcnR1ZXMuRk9SVElUVURFXS52YWx1ZSxcbiAgICAgIGV4cGVkaXRvci5EdXJhVHJlZVtWaXJ0dWVzLkNFTEVSSVRZXS52YWx1ZSxcbiAgICAgIGV4cGVkaXRvci5EdXJhVHJlZVtWaXJ0dWVzLlNPUkNFUlldLnZhbHVlLFxuICAgICAgZXhwZWRpdG9yLkR1cmFUcmVlW1ZpcnR1ZXMuU1VTVEVOQU5DRV0udmFsdWUsXG4gICAgICBjb21tZW50RmllbGQudmFsdWUsXG4gICAgICBkaXNjYXJkZWQuY2hlY2tlZFxuICAgICk7XG4gIH0pO1xufVxuXG4vLyBUT0RPXG4vLyBzaW5jZSBhbGwgYXR0YWNrcmVtIGZ1bmMgbWVyZ2VkIGhlcmUuIHdpbGwgYmUgZ3JlYXQgdG8gaW1wbGVtZW50IGNhbGN1bGF0aW9uIG9uIHRoZSBlbmQgZGF0ZSBvZiBzZWFzb25cbi8vIGZ1bmN0aW9uIGlucHV0Q2hhbmdlKGU6IEhUTUxJbnB1dEVsZW1lbnQpIHtcbi8vICAgaWYgKGUudHlwZSA9PT0gXCJkYXRldGltZS1sb2NhbFwiKSB7XG4vLyAgICAgQWJFeC5zdGFydEQgPSBlLnZhbHVlQXNEYXRlO1xuLy8gICB9IGVsc2Uge1xuLy8gICAgIGUuc2V0QXR0cmlidXRlKFwidmFsdWVcIiwgZS52YWx1ZSk7XG4vLyAgIH1cbi8vIH1cbiJdfQ==